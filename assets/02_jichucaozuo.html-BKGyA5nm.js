import{_ as s,c as a,a as p,o as t}from"./app-DxZOFQRu.js";const e="/blog-vp-reco/cv/ImageProcessing/02_xxx/13_lena_R.png",c="/blog-vp-reco/cv/ImageProcessing/02_xxx/14_lena_G.png",l="/blog-vp-reco/cv/ImageProcessing/02_xxx/15_lena_B.png",o="/blog-vp-reco/cv/ImageProcessing/02_xxx/16_lena_R.png",i="/blog-vp-reco/cv/ImageProcessing/02_xxx/17_lena_G.png",u="/blog-vp-reco/cv/ImageProcessing/02_xxx/18_lena_B.png",r="/blog-vp-reco/cv/ImageProcessing/02_xxx/19_plt1.png",k="/blog-vp-reco/cv/ImageProcessing/02_xxx/20_plt2.png",d="/blog-vp-reco/cv/ImageProcessing/02_xxx/21_hsv.webp",m="/blog-vp-reco/cv/ImageProcessing/02_xxx/22_hsv1.png",v="/blog-vp-reco/cv/ImageProcessing/02_xxx/23_hsv1.png",g="/blog-vp-reco/cv/ImageProcessing/02_xxx/24_lena1.png",b="/blog-vp-reco/cv/ImageProcessing/02_xxx/24_lena2.png",h="/blog-vp-reco/cv/ImageProcessing/02_xxx/25_hsv.png",_="/blog-vp-reco/cv/ImageProcessing/02_xxx/26_lena1.png",y="/blog-vp-reco/cv/ImageProcessing/02_xxx/26_lena2.png",f="/blog-vp-reco/cv/ImageProcessing/02_xxx/27_Lab_clahe.png",x="/blog-vp-reco/cv/ImageProcessing/02_xxx/28_lab_ch1.png",w="/blog-vp-reco/cv/ImageProcessing/02_xxx/28_lab_ch2.png",R="/blog-vp-reco/cv/ImageProcessing/02_xxx/11_lena_scale.png",C="/blog-vp-reco/cv/ImageProcessing/02_xxx/10_crop.jpeg",G="/blog-vp-reco/cv/ImageProcessing/02_xxx/12_padding.jpeg",L="/blog-vp-reco/cv/ImageProcessing/02_xxx/12_padding_1.jpeg",B="/blog-vp-reco/cv/ImageProcessing/02_xxx/12_padding_2.jpeg",q="/blog-vp-reco/cv/ImageProcessing/02_xxx/12_padding_3.jpeg",S="/blog-vp-reco/cv/ImageProcessing/02_xxx/02_lena_ro90.png",z="/blog-vp-reco/cv/ImageProcessing/02_xxx/03_lena_ro180.png",O="/blog-vp-reco/cv/ImageProcessing/02_xxx/04_lena_ro270.png",I="/blog-vp-reco/cv/ImageProcessing/02_xxx/05_lena_45.png",V="/blog-vp-reco/cv/ImageProcessing/02_xxx/06_lena_200.png",P="/blog-vp-reco/cv/ImageProcessing/02_xxx/05_lena_45_1.png",E="/blog-vp-reco/cv/ImageProcessing/02_xxx/07_lena_flip_h.png",A="/blog-vp-reco/cv/ImageProcessing/02_xxx/08_lena_flip_v.png",H="/blog-vp-reco/cv/ImageProcessing/02_xxx/09_lena_flip_hv.png",j="/blog-vp-reco/cv/ImageProcessing/02_xxx/29_poker1.webp",T="/blog-vp-reco/cv/ImageProcessing/02_xxx/29_poker2.jpeg",M={};function N(F,n){return t(),a("div",null,n[0]||(n[0]=[p(`<h2 id="_1-hello-opencv" tabindex="-1"><a class="header-anchor" href="#_1-hello-opencv"><span>1. Hello, OpenCV!</span></a></h2><h3 id="_1-1-读取写入" tabindex="-1"><a class="header-anchor" href="#_1-1-读取写入"><span>1.1 读取写入</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"></span>
<span class="line"><span class="token comment"># ------------ 英文路径读写 ------------</span></span>
<span class="line">img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;./input_dir/en.jpg&quot;</span><span class="token punctuation">,</span> flags<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">&quot;./output_dir/en.jpg&quot;</span><span class="token punctuation">,</span> img1<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ------------ 中文路径读写 ------------</span></span>
<span class="line">img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imdecode<span class="token punctuation">(</span>np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span><span class="token string">&quot;测试图片.jpg&quot;</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imencode<span class="token punctuation">(</span><span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tofile<span class="token punctuation">(</span><span class="token string">&quot;输出图片.jpg&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>1. 英文路径读写（正常）：</strong></p><p>第一个参数都是字符串类型，通过<mark>相对路径</mark>或者<mark>绝对路径</mark>的方式来读取、存储图像数据。第二个参数 flags 是一个可选参数，表示读取图像的方式，默认为 1：</p><ul><li>cv2.IMREAD_COLOR(1)：加载一张三通道彩色图，通道顺序为 BGR，忽视透明度（默认值）。</li><li>cv2.IMREAD_GRAYSCALE(0)：加载一张单通道灰度图。</li><li>cv2.IMREAD_UNCHANGED(-1)：原样读取，包含 Alpha 通道（透明度）也能读取到。</li></ul><p><strong>2. 中文路径读写（特殊）：</strong></p><p>OpenCV 的 cv2.imread / cv2.imwrite 底层调用的是 C/C++ 的标准文件 I/O，它对中文（或非 ASCII 字符）路径支持不好，所以直接读写中文路径文件会报错或返回 None。解决办法是：</p><ul><li>读：先用 np.fromfile 把文件按二进制形式读入，再用 cv2.imdecode 解码成图像。</li><li>写：先用 cv2.imencode 把图像编码成二进制数据，再用 .tofile 保存为中文路径文件。</li></ul><p>这种方式绕过了 OpenCV 的路径解析，直接用 Python 和 Numpy 处理文件的二进制数据，再交给 OpenCV 做解码/编码。</p><p>imdecode 中的第二个参数 -1，和 imread 中的 flags 是一致的。imencode 返回的是一个数组，[success_flag, encoded_img]，encoded_img 是二进制图像数据；success_flag 是布尔值，False 的话 encoded_img 为空。</p><h3 id="_1-2-数据类型" tabindex="-1"><a class="header-anchor" href="#_1-2-数据类型"><span>1.2 数据类型</span></a></h3><p>图像在读取过程中，可以大致分为<mark>整型</mark>和<mark>浮点型</mark>两种。在不同的编程语言下，写法是不一样的。</p><table><thead><tr><th style="text-align:center;">C++类型</th><th style="text-align:center;">Python 类型（Numpy）</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">CV_8U / CV_8UC1</td><td style="text-align:center;">np.uint8</td><td style="text-align:center;">单通道 8 位无符号整数图像（灰度图像）</td></tr><tr><td style="text-align:center;">CV_8UC3</td><td style="text-align:center;">np.uint8</td><td style="text-align:center;">三通道 8 位无符号整数图像（彩色图像）</td></tr><tr><td style="text-align:center;">CV_32F</td><td style="text-align:center;">np.float32</td><td style="text-align:center;">单通道 32 位浮点图像</td></tr><tr><td style="text-align:center;">CV_32FC3</td><td style="text-align:center;">np.float32</td><td style="text-align:center;">三通道 32 位浮点图像</td></tr><tr><td style="text-align:center;">CV_32FC2</td><td style="text-align:center;">np.complex64</td><td style="text-align:center;">双通道复数浮点图像</td></tr></tbody></table><p>我们日常使用的图像读写，走的都是默认的 unit8。一些简单的图像运算、滤波、几何变换，也许内部会转换为浮点类型，但处理完还是 unit8，它会自动处理。</p><p>在目前的图像处理中，浮点图像的像素值一般都在 [0,1] 或者 [-1,1] 的范围内。比如深度学习（神经网络）处理前要对图像数据进行归一化。在保存（imwrite）的过程中，浮点类型也会强制要求转换为 uint8 格式，否则保存的图片可能不能正常显示。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">float_img <span class="token operator">=</span> np<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>float_img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 假设限制范围在 [0,1]</span></span>
<span class="line">uint8_img <span class="token operator">=</span> <span class="token punctuation">(</span>float_img <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>  <span class="token comment"># 缩放至 [0,255]，转换为整型</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">&#39;output.jpg&#39;</span><span class="token punctuation">,</span> uint8_img<span class="token punctuation">)</span>  <span class="token comment"># 写入</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>复数数据 complex64 在光学、信号处理类任务中比较常见，因为傅里叶变换（DFT / FFT）的结果是复数，需要双通道保存实部和虚部。但是一般的入门图像处理中，很难见到，包括这些高精度图像 unit16（float64）：</p><ul><li>医学影像 CT/MRI（像素值范围远大于 0~255）。</li><li>HDR 图像（高动态范围，亮度可能大于 255）。</li></ul><h3 id="_1-3-显示方式" tabindex="-1"><a class="header-anchor" href="#_1-3-显示方式"><span>1.3 显示方式</span></a></h3><p><strong>1. OpenCV 自带窗口 (cv2.imshow)</strong></p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;test.jpg&quot;</span><span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&quot;image&quot;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>  <span class="token comment"># 默认使用 BGR 通道顺序，色彩正常</span></span>
<span class="line">cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 等待按键（毫秒），0 表示无限等待，时间太短会一闪而过</span></span>
<span class="line">cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 可选操作，手动释放占用的内存</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>cv2.imshow()的过程中，整型和浮点类型都可以显示，但是需要注意像素值的区间，整型为 [0, 255]，浮点型为 [0.0, 1.0]。如果超出范围，是不能被正常显示的。</p><p><strong>2. Matplotlib (plt.imshow)</strong></p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;test.jpg&quot;</span><span class="token punctuation">)</span></span>
<span class="line">img_rgb <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span>  <span class="token comment"># 通道顺序从 BGR 转换成 RGB</span></span>
<span class="line">plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_rgb<span class="token punctuation">)</span>  <span class="token comment"># 获取图像的数据和格式</span></span>
<span class="line">plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&quot;off&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 将坐标轴等信息都关闭，保留空白画布</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 显示图像</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>plt.imshow()只是能获取图像的数据和格式，要显示还需要 plt.show()。与 cv2.imshow()一致，整形和浮点类型都能显示。</p><p>根据广大网友(博客帖子)的经验，OpenCV 的显示适用于，后续还有对原图的其他操作，并且要展示出来的情况；Matplotlib 不需要展示原始图像，而是绘制一张新的图像，只对当前这个结果进行显示和处理。</p><h3 id="_1-4-格式转换" tabindex="-1"><a class="header-anchor" href="#_1-4-格式转换"><span>1.4 格式转换</span></a></h3><p>图像格式种类很多，但根据应用场景，大致分三类：</p><ul><li><strong>栅格图像类型</strong>：JPG、PNG、GIF、BMP、TIFF</li><li><strong>新兴网络格式</strong>：WebP、HEIF</li><li><strong>专业格式</strong>：RAW、PSD、SVG</li></ul><ol><li>常见栅格图像格式</li></ol><ul><li><mark>JPG/JPEG</mark> 是最常见的格式，相机拍摄、网络传输等使用的很多。特点是无透明通道，有损压缩（压缩多次会画质下降），但体积较小。</li><li><mark>PNG</mark> 是无损压缩，支持透明通道。适合图标、UI、插画，但文件体积通常大于 JPG。</li><li><mark>BMP</mark> 无压缩，体积大，读写速度快。曾经在 Windows/游戏里很常见，但现在基本被 PNG/JPG 取代。</li><li><mark>GIF</mark> 支持动图（帧序列），但最多 256 色。</li><li><mark>TIFF</mark> 支持无损和有损压缩，兼容高位深（16 位、32 位）。多用于科研、医学成像、扫描。</li></ul><ol start="2"><li>新兴网络格式（主要面向网络和移动设备）</li></ol><ul><li><mark>WebP</mark> 是 Google 推出的，压缩比更高，比 JPG/PNG 体积小。支持无损和透明度，也支持动图。目前 Chrome、Firefox、Edge 等浏览器都支持显示。</li><li><mark>HEIF / HEIC</mark> 在苹果生态(IOS)里常见，相比 JPEG 体积更小，画质更好，但多平台的兼容性较差。</li></ul><ol start="3"><li>专业格式</li></ol><ul><li><mark>RAW</mark> 是相机拍摄的原始图像数据，未经过压缩或轻度压缩。体积非常大，需要专门软件（Lightroom、Photoshop）处理。优点是后期调色空间更大。</li><li><mark>PSD</mark> 是 Photoshop 的专用格式，带有图层、蒙版等信息。虽然是图像文件，但更多是「项目文件」，不属于通用图像格式。</li><li><mark>SVG/AI/EPS</mark> 等格式是基于 XML 的矢量图格式，常用于网页图标、插画。特点是无论放多大都不失真。</li></ul><p>回顾一下，《综述》中有说过，Pillow 支持更多格式，所以格式转换用 Pillow 的更多。<mark>OpenCV 仅支持 JPEG(.jpg, .jpeg)，PNG，BMP(.bmp, .dib)，TIFF(.tif, .tiff)</mark>，这些常见格式，转换的方法也十分简单，OpenCV 本身不关心「文件格式」，它读进来的就是 矩阵（numpy 数组），格式转换的本质就是重新保存：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;test.jpg&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 读入原图</span></span>
<span class="line"></span>
<span class="line">cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">&quot;output.png&quot;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>  <span class="token comment"># 转 PNG</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">&quot;output.bmp&quot;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>  <span class="token comment"># 转 BMP</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">&quot;output.tiff&quot;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>  <span class="token comment"># 转 TIFF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-色彩空间变换" tabindex="-1"><a class="header-anchor" href="#_2-色彩空间变换"><span>2. 色彩空间变换</span></a></h2><p>在数字图像处理中，<strong>色彩空间（Color Space）</strong> 描述了图像中颜色的表示方式。不同的色彩空间具有不同的特点和适用场景，例如有些色彩空间强调视觉直观性，有些则方便图像处理或颜色分析。常用的色彩空间包括 RGB、Grayscale、HSV、Lab、YUV、CMYK 等，各自适用于显示、图像分析、视频编码或打印等任务。</p><table><thead><tr><th>色彩空间</th><th>特点</th><th>典型应用</th></tr></thead><tbody><tr><td>RGB</td><td>最常用，直观但不独立</td><td>图像显示、简单处理</td></tr><tr><td>Grayscale</td><td>简化为单通道</td><td>特征检测、边缘检测</td></tr><tr><td>HSV / HLS</td><td>色调和饱和度独立</td><td>目标检测、颜色过滤</td></tr><tr><td>YUV / YCbCr</td><td>分离亮度和色度</td><td>视频编码、人脸检测</td></tr><tr><td>Lab</td><td>与人眼感知接近</td><td>图像增强、颜色分割</td></tr><tr><td>CMYK</td><td>针对打印优化</td><td>图像输出到打印设备</td></tr><tr><td>XYZ / LUV</td><td>高精度颜色管理和分析</td><td>专业颜色匹配、颜色测量</td></tr></tbody></table><h3 id="_2-1-cv2-cvtcolor" tabindex="-1"><a class="header-anchor" href="#_2-1-cv2-cvtcolor"><span>2.1 cv2.cvtColor()</span></a></h3><p>在 cv2.imread() 读取图像时，可以使用 flags(-1,0,1) 来决定灰度图/彩色图。除此之外，还可以用 cvtColor 函数进行两者之间的转化。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;test.jpg&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 读取 BGR 彩色图像</span></span>
<span class="line">img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>  <span class="token comment"># 彩色 BGR 转灰度</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>命名理解起来还是挺简单的，并且挺有意思：两个颜色中间的 2 就是 to 的谐音，2 前是当前颜色空间，2 后是目标颜色空间。</p><p>需要注意的是，灰度图像无法恢复原始彩色信息。灰度图像只保留亮度信息，当转换为三通道图像时，通常只是将灰度值复制到 R、G、B 三个通道上，形成“伪彩色图像”。OpenCV 中的加权方式大概是这样：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>G</mi><mi>r</mi><mi>a</mi><mi>y</mi><mo>=</mo><mn>0.114</mn><mo>×</mo><mi>B</mi><mo>+</mo><mn>0.587</mn><mo>×</mo><mi>G</mi><mo>+</mo><mn>0.299</mn><mo>×</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">Gray = 0.114×B + 0.587×G + 0.299×R </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">0.114</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">0.587</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">0.299</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span></span></p><p>该函数的参数一共有四个，我们一般用的都是前两个：src 是一个 numpy 数组，表示读取到的图像数据；code 就是转换代码，决定输入和输出色彩空间，例如 COLOR_BGR2GRAY。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>src<span class="token punctuation">,</span> code<span class="token punctuation">,</span> dst<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> dstCn<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 全部参数</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>dst 表示输出图像，Python 中基本用不到，这个接口是留给 C++用的。dstCn 表示输出图像的通道数，默认值 0 表示自动匹配，可以手动指定。</p><p>OpenCV 的转换代码（code）超过 150 种，但我们常用的真的不多，按照类别可以整理成这样：</p><ol><li><mark>通道变换</mark>：BGR ↔ RGB ↔ RGBA</li><li><mark>灰度变换</mark>：BGR，RGB，RGBA ↔ GRAY</li><li><mark>HSV/Lab 等</mark>：BGR，RGB，RGBA ↔ HSV，HLS，Lab，Luv，YCrCb</li><li><mark>浮点型/高精度</mark>：BGR，RGB，RGBA ↔ XYZ</li></ol><p>双箭头(↔)两边的值都是可以相互转换的，但要注意的是，HSV 等色彩空间都是 3 通道，没有 alpha 通道，从 RGBA 转换为 HSV 时，透明度信息会直接丢弃，如果要从 HSV 转换会 RGBA，需要手动拼接 alpha 通道。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 1. 读取带透明通道的 PNG 图像，打印形状</span></span>
<span class="line">img_rgba <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;image.png&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># shape: H x W x 4</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Original shape:&quot;</span><span class="token punctuation">,</span> img_rgba<span class="token punctuation">.</span>shape<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. 分离 alpha 通道，转换成 HSV</span></span>
<span class="line">rgb <span class="token operator">=</span> img_rgba<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>    <span class="token comment"># RGB，通道索引 [0，1，2]</span></span>
<span class="line">alpha <span class="token operator">=</span> img_rgba<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>   <span class="token comment"># alpha，通道索引 [3]</span></span>
<span class="line">hsv <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>rgb<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2HSV<span class="token punctuation">)</span>  <span class="token comment"># RGB -&gt; HSV</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. 处理 HSV 图像</span></span>
<span class="line"><span class="token comment"># ------------ 对 HSV 进行处理 ------------</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. 从 HSV 转换回 RGB，拼接 alpha 通道</span></span>
<span class="line">rgb_result <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>hsv<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_HSV2RGB<span class="token punctuation">)</span>  <span class="token comment"># HSV -&gt; RGB</span></span>
<span class="line">rgba_result <span class="token operator">=</span> cv2<span class="token punctuation">.</span>merge<span class="token punctuation">(</span><span class="token punctuation">[</span>rgb_result<span class="token punctuation">,</span> alpha<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 合并 alpha 通道</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 5. 保存结果，打印形状</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">&quot;image_hsv_processed.png&quot;</span><span class="token punctuation">,</span> rgba_result<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Processed image saved, shape:&quot;</span><span class="token punctuation">,</span> rgba_result<span class="token punctuation">.</span>shape<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-rgb-色彩空间" tabindex="-1"><a class="header-anchor" href="#_2-2-rgb-色彩空间"><span>2.2 RGB 色彩空间</span></a></h3><h4 id="_2-2-1-使用-cv2-split-分离-rgb-通道" tabindex="-1"><a class="header-anchor" href="#_2-2-1-使用-cv2-split-分离-rgb-通道"><span>2.2.1 使用 cv2.split() 分离 RGB 通道</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;img_process_0/lena.png&#39;</span><span class="token punctuation">)</span></span>
<span class="line">b<span class="token punctuation">,</span> g<span class="token punctuation">,</span> r <span class="token operator">=</span> cv2<span class="token punctuation">.</span>split<span class="token punctuation">(</span>img<span class="token punctuation">)</span>  <span class="token comment"># 分离通道</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>cv2.split(img)：将 RGB 图像拆分为 3 个单通道图像，分别对应 B、G、R 通道。要注意的是，因为单通道的原因，这三个图像都是灰度图像，直接 cv2.imshow()的话，每个通道显示的是其强度值（0-255）：</p><ul><li>R 通道（G 通道、B 通道）： 红色通道（绿色通道、蓝色通道）的强度值显示为白色，其他地方为黑色。</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Red Channel&#39;</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>   <span class="token comment"># 红色通道</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Green Channel&#39;</span><span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token comment"># 绿色通道</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Blue Channel&#39;</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>  <span class="token comment"># 蓝色通道</span></span>
<span class="line">cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这种分离方式只是直观地表示每个通道的像素强度，而不是实际的颜色，强度值越高看着越亮，反之看着越暗。单看代码和解释肯定很懵逼，到了经典的 lena 时刻：</p><div class="layout"><figure><img src="`+e+'" alt="2.1 Red通道" width="240" tabindex="0" loading="lazy"><figcaption>2.1 Red通道</figcaption></figure><figure><img src="'+c+'" alt="2.2 Green通道" width="240" tabindex="0" loading="lazy"><figcaption>2.2 Green通道</figcaption></figure><figure><img src="'+l+`" alt="2.3 Blue通道" width="240" tabindex="0" loading="lazy"><figcaption>2.3 Blue通道</figcaption></figure></div><h4 id="_2-2-2-合并通道显示特定色相" tabindex="-1"><a class="header-anchor" href="#_2-2-2-合并通道显示特定色相"><span>2.2.2 合并通道显示特定色相</span></a></h4><p>通过 cv2.merge() 可以将某个通道的值保留，同时将其他通道设置为 0，重新组合成新的 RGB 图像。种方式可以直观展示某一颜色成分的空间分布。与单通道灰度显示相比，更容易理解图像的颜色结构。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">zero_channel <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">&#39;uint8&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 创建空白通道</span></span>
<span class="line"></span>
<span class="line">blue <span class="token operator">=</span> cv2<span class="token punctuation">.</span>merge<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> zero_channel<span class="token punctuation">,</span> zero_channel<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 只保留蓝色</span></span>
<span class="line">green <span class="token operator">=</span> cv2<span class="token punctuation">.</span>merge<span class="token punctuation">(</span><span class="token punctuation">[</span>zero_channel<span class="token punctuation">,</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> zero_channel<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 只保留绿色</span></span>
<span class="line">red <span class="token operator">=</span> cv2<span class="token punctuation">.</span>merge<span class="token punctuation">(</span><span class="token punctuation">[</span>zero_channel<span class="token punctuation">,</span> zero_channel<span class="token punctuation">,</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 只保留红色</span></span>
<span class="line"></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Blue&#39;</span><span class="token punctuation">,</span> blue<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Green&#39;</span><span class="token punctuation">,</span> green<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Red&#39;</span><span class="token punctuation">,</span> red<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="layout"><figure><img src="`+o+'" alt="2.4 Red合并通道" width="240" tabindex="0" loading="lazy"><figcaption>2.4 Red合并通道</figcaption></figure><figure><img src="'+i+'" alt="2.5 Green合并通道" width="240" tabindex="0" loading="lazy"><figcaption>2.5 Green合并通道</figcaption></figure><figure><img src="'+u+`" alt="2.6 Blue合并通道" width="240" tabindex="0" loading="lazy"><figcaption>2.6 Blue合并通道</figcaption></figure></div><h4 id="_2-2-3-matplotlib-中的-cmap-映射" tabindex="-1"><a class="header-anchor" href="#_2-2-3-matplotlib-中的-cmap-映射"><span>2.2.3 Matplotlib 中的 cmap 映射</span></a></h4><p>plt 的自动颜色映射（cmap=&quot;XXX&quot;），可以直接显示出对应通道的色相，原理和上一小节的“合并通道”是一样的，只不过 plt 内部自动执行了。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>b<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;Blues&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Blue Channel&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>g<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;Greens&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Green Channel&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">133</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>r<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;Reds&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Red Channel&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是这个结果，让我感觉锐化很严重。Chat-gpt 告诉我，这是因为梯度颜色映射会放大像素之间的细微差异，从而使边缘和纹理更明显，看起来像是经过了“锐化处理”。我更偏爱 imshow 的视觉观感。</p><figure><img src="`+r+'" alt="2.7 plt中显示单通道-1" width="560" tabindex="0" loading="lazy"><figcaption>2.7 plt中显示单通道-1</figcaption></figure><p>如果要显示单通道像素的颜色强度值，我们只需要把 cmap 的值全部改为 gray 就可以了。</p><figure><img src="'+k+'" alt="2.8 plt中显示单通道-2" width="560" tabindex="0" loading="lazy"><figcaption>2.8 plt中显示单通道-2</figcaption></figure><h3 id="_2-3-hsv-色彩空间" tabindex="-1"><a class="header-anchor" href="#_2-3-hsv-色彩空间"><span>2.3 HSV 色彩空间</span></a></h3><h4 id="_2-3-1-什么是-hsv-色彩空间" tabindex="-1"><a class="header-anchor" href="#_2-3-1-什么是-hsv-色彩空间"><span>2.3.1 什么是 HSV 色彩空间？</span></a></h4><p>HSV（Hue, Saturation, Value）是基于人类视觉感知的色彩模型，比 RGB 色彩空间更适合处理颜色检测和分割任务。</p><ul><li><mark>Hue(色调)</mark>: 表示颜色的类型，以角度(0°-360°)表示，例如：红色为 0°，绿色为 120°，蓝色为 240°。</li><li><mark>Saturation(饱和度)</mark>: 表示颜色的纯度，范围为 0%到 100%。</li><li><mark>Value(亮度)</mark>: 表示颜色的亮度，范围为 0%到 100%。</li></ul><div class="layout"><figure><img src="'+d+'" alt="2.9 HSV图解1" width="240" tabindex="0" loading="lazy"><figcaption>2.9 HSV图解1</figcaption></figure><figure><img src="'+m+`" alt="2.10 HSV图解2" width="240" tabindex="0" loading="lazy"><figcaption>2.10 HSV图解2</figcaption></figure></div><h4 id="_2-3-2-rgb-与-hsv-的对比" tabindex="-1"><a class="header-anchor" href="#_2-3-2-rgb-与-hsv-的对比"><span>2.3.2 RGB 与 HSV 的对比</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 读取图像并转换为HSV</span></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;img_process_0/lena.png&#39;</span><span class="token punctuation">)</span></span>
<span class="line">hsv <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2HSV<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">img_rgb <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 显示图像</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_rgb<span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Original RGB&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>hsv<span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;HSV&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+v+`" alt="2.11 plt 中 RGB 和 HSV 的对比" width="560" tabindex="0" loading="lazy"><figcaption>2.11 plt 中 RGB 和 HSV 的对比</figcaption></figure><h4 id="_2-3-3-常见颜色-hsv-范围参考表" tabindex="-1"><a class="header-anchor" href="#_2-3-3-常见颜色-hsv-范围参考表"><span>2.3.3 常见颜色 HSV 范围参考表</span></a></h4><table><thead><tr><th>颜色</th><th>H (色调)</th><th>S (饱和度)</th><th>V (亮度)</th></tr></thead><tbody><tr><td>红色 (低范围)</td><td>0 - 10</td><td>100 - 255</td><td>100 - 255</td></tr><tr><td>红色 (高范围)</td><td>160 - 180</td><td>100 - 255</td><td>100 - 255</td></tr><tr><td>橙色</td><td>11 - 25</td><td>100 - 255</td><td>100 - 255</td></tr><tr><td>黄色</td><td>26 - 35</td><td>100 - 255</td><td>100 - 255</td></tr><tr><td>绿色</td><td>36 - 85</td><td>100 - 255</td><td>100 - 255</td></tr><tr><td>青色</td><td>86 - 100</td><td>100 - 255</td><td>100 - 255</td></tr><tr><td>蓝色</td><td>101 - 130</td><td>100 - 255</td><td>100 - 255</td></tr><tr><td>紫色</td><td>131 - 160</td><td>100 - 255</td><td>100 - 255</td></tr></tbody></table><p>红色是一个比较特殊的范围，虽然我们看色环的时候，是收尾相接的，但是在 HSV 中并不能，如果需要同时提取高范围和低范围的红色，需要写两次范围分别提取。</p><p>另外，饱和度和亮度在实际的计算中取的是百分比，就比如 120/255=47%，中等程度的饱和度。之所以写的是 100 - 255，而不是 0 - 255，是因为我们在处理色彩提取的时候，通常只关心高饱和度和高亮度的范围。</p><h4 id="_2-3-4-提取特定颜色范围" tabindex="-1"><a class="header-anchor" href="#_2-3-4-提取特定颜色范围"><span>2.3.4 提取特定颜色范围</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 定义紫色的HSV范围</span></span>
<span class="line">lower_red <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">131</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">upper_red <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">160</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 提取紫色区域</span></span>
<span class="line">mask <span class="token operator">=</span> cv2<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>hsv<span class="token punctuation">,</span> lower_red<span class="token punctuation">,</span> upper_red<span class="token punctuation">)</span></span>
<span class="line">result <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>img<span class="token punctuation">,</span> img<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 显示结果</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Original&#39;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Mask&#39;</span><span class="token punctuation">,</span> mask<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Result&#39;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>cv2.inRange() 生成掩码，将 HSV 图像中特定范围的颜色提取出来。</li><li>cv2.bitwise_and() 按位操作提取掩码指定的区域。</li></ul><div class="layout"><figure><img src="`+g+'" alt="2.12 HSV提取特定颜色 Mask" width="240" tabindex="0" loading="lazy"><figcaption>2.12 HSV提取特定颜色 Mask</figcaption></figure><figure><img src="'+b+`" alt="2.13 HSV提取特定颜色 Result" width="240" tabindex="0" loading="lazy"><figcaption>2.13 HSV提取特定颜色 Result</figcaption></figure></div><h4 id="_2-3-5-hsv-色彩通道可视化" tabindex="-1"><a class="header-anchor" href="#_2-3-5-hsv-色彩通道可视化"><span>2.3.5 HSV 色彩通道可视化</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">h<span class="token punctuation">,</span> s<span class="token punctuation">,</span> v <span class="token operator">=</span> cv2<span class="token punctuation">.</span>split<span class="token punctuation">(</span>hsv<span class="token punctuation">)</span>  <span class="token comment"># 分离HSV通道</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 显示各通道</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>h<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&#39;hsv&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Hue&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>s<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&#39;gray&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Saturation&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">133</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>v<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&#39;gray&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Value&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Hue 通道显示色相信息，颜色范围对应色谱环。</li><li>Saturation 和 Value 通道使用灰度显示数值强度。</li></ul><figure><img src="`+h+`" alt="2.14 HSV三通道可视化" width="560" tabindex="0" loading="lazy"><figcaption>2.14 HSV三通道可视化</figcaption></figure><h3 id="_2-4-lab-色彩空间" tabindex="-1"><a class="header-anchor" href="#_2-4-lab-色彩空间"><span>2.4 Lab 色彩空间</span></a></h3><h4 id="_2-4-1-什么是-lab-色彩空间" tabindex="-1"><a class="header-anchor" href="#_2-4-1-什么是-lab-色彩空间"><span>2.4.1 什么是 Lab 色彩空间？</span></a></h4><p>Lab 色彩空间是由国际照明委员会（CIE）提出的一种感知均匀的颜色空间。与 RGB 不同，RGB 是设备相关空间，三原色混合表示颜色，亮度和颜色混合在一起；Lab 将亮度和色彩分离，更符合人眼感知。</p><ul><li><strong>L</strong>：亮度（Lightness），范围 0–100</li><li><strong>a</strong>：绿色到红色轴（-128 → +127）</li><li><strong>b</strong>：蓝色到黄色轴（-128 → +127）</li></ul><p>Lab 的显示与设备无关（Device Independent），可以在不同显示设备间保持一致性。常用于颜色校正、图像增强、颜色分析、印刷、摄影后处理等。</p><h4 id="_2-4-2-rbg-与-lab-的直观对比" tabindex="-1"><a class="header-anchor" href="#_2-4-2-rbg-与-lab-的直观对比"><span>2.4.2 RBG 与 Lab 的直观对比</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;lena.png&#39;</span><span class="token punctuation">)</span></span>
<span class="line">img_rgb <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对比思路：用同一张图像，同时在 RGB 空间和 Lab 空间做一些调整亮度或颜色的操作。输出图像做对比。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># ---------------- RGB 空间亮度/对比度增强 ----------------</span></span>
<span class="line">img_rgb_bright <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convertScaleAbs<span class="token punctuation">(</span>img_rgb<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># img_rgb_bright = cv2.convertScaleAbs(img_rgb, alpha=1.6, beta=0)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ---------------- Lab 空间亮度/对比度增强 ----------------</span></span>
<span class="line">img_lab <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img_rgb<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2LAB<span class="token punctuation">)</span></span>
<span class="line">L<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b <span class="token operator">=</span> cv2<span class="token punctuation">.</span>split<span class="token punctuation">(</span>img_lab<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 只增强亮度通道 L</span></span>
<span class="line">L <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convertScaleAbs<span class="token punctuation">(</span>L<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># L = cv2.convertScaleAbs(L, alpha=1.6, beta=0)</span></span>
<span class="line">img_lab_bright <span class="token operator">=</span> cv2<span class="token punctuation">.</span>merge<span class="token punctuation">(</span><span class="token punctuation">[</span>L<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">img_lab_bright <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img_lab_bright<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_LAB2RGB<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ---------------- matplotlib 显示 ----------------</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_rgb<span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Original Image&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_rgb_bright<span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;RGB Enhance&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_lab_bright<span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Lab Enhance&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>cv2.convertScaleAbs()函数，用来调整图像亮度和对比度，同时保证输出为 8 位无符号整数 (unit8)。</li><li>Matplotlib 显示时，plt.imshow() 会自动做 色彩归一化（尤其是整数类型的图像），或者进行 gamma 校正，这可能让亮度增强的差异看起来被压平了，所以需要用 vmin/vmax 调参。</li></ol><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># src 表示 输入图像（可以是灰度或者彩色）</span></span>
<span class="line"><span class="token comment"># alpha 表示 缩放系数，作用类似“对比度”调整，默认 1.0。数值越大，对比越强。</span></span>
<span class="line"><span class="token comment"># beta 表示 偏移量，作用类似“亮度”调整，默认 0。数值越大，图像整体越亮。</span></span>
<span class="line">dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convertScaleAbs<span class="token punctuation">(</span>src<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># vmin=0, vmax=255，保证像素值按原始强度显示，不会被自动归一化。</span></span>
<span class="line">plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_rgb_bright<span class="token punctuation">,</span> vmin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第一个结果是<mark>仅亮度增强(beta=120)</mark>，可以很明显的看出，Lab 空间调整亮度时颜色不变，而 RGB 空间亮度调整让颜色偏移了。</p><figure><img src="`+_+'" alt="2.15 RGB 与 Lab 亮度调整对比" width="560" tabindex="0" loading="lazy"><figcaption>2.15 RGB 与 Lab 亮度调整对比</figcaption></figure><p>第二个结果是<mark>仅对比度增强(alpha=1.6)</mark>，Lab 调对比度比 RGB 更稳定，对颜色偏移不敏感；RGB 调对比度可能影响颜色，尤其在高饱和区域更明显。</p><p>这是由于 Lab 的 L 通道是感知均匀亮度，对比度增强更符合人眼对亮度的线性感知。RGB 通道混合了亮度和色彩信息，增强对比时会同时改变颜色分量。</p><figure><img src="'+y+`" alt="2.16 RGB 与 Lab 对比度调整对比" width="560" tabindex="0" loading="lazy"><figcaption>2.16 RGB 与 Lab 对比度调整对比</figcaption></figure><h4 id="_2-4-3-clahe-直方图均衡化算法" tabindex="-1"><a class="header-anchor" href="#_2-4-3-clahe-直方图均衡化算法"><span>2.4.3 CLAHE 直方图均衡化算法</span></a></h4><p>CLAHE 是一种非常经典的直方图均衡化算法，英文全称是 Contrast Limited Adaptive Histogram Equalization，该算法源于 1994 年发表的论文。如今几乎所有的图像处理软件，包括 OpenCV，ImageJ，Matlab 等都支持 CLAHE 算法。它的主要作用在于增强图像的对比度同时能够抑制噪声。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">clahe <span class="token operator">=</span> cv2<span class="token punctuation">.</span>createCLAHE<span class="token punctuation">(</span>clipLimit<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">,</span> tileGridSize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化 CLAHE</span></span>
<span class="line">L_eq <span class="token operator">=</span> clahe<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>  <span class="token comment"># 对 L 通道应用，赋值给 L_eq</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>clipLimit [1,4]。值越小，对比度变化越温和；值越大，对比度增强越明显，但可能引入噪点。</li><li>tileGridSize 小块网格大小。小块越多，增强局部细节，轮廓更明显；小块越少，类似全局均衡化，局部差异不明显。</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 转为 Lab 空间，CLAHE 对 L 通道做亮度均衡化</span></span>
<span class="line">img_lab <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img_rgb<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_RGB2LAB<span class="token punctuation">)</span></span>
<span class="line">L<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b <span class="token operator">=</span> cv2<span class="token punctuation">.</span>split<span class="token punctuation">(</span>img_lab<span class="token punctuation">)</span></span>
<span class="line">clahe <span class="token operator">=</span> cv2<span class="token punctuation">.</span>createCLAHE<span class="token punctuation">(</span>clipLimit<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">,</span> tileGridSize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">L_eq <span class="token operator">=</span> clahe<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 合并回 Lab 再转回 RGB</span></span>
<span class="line">img_lab_eq <span class="token operator">=</span> cv2<span class="token punctuation">.</span>merge<span class="token punctuation">(</span><span class="token punctuation">[</span>L_eq<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">img_lab_eq <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img_lab_eq<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_LAB2RGB<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 显示对比</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_rgb<span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Original Image&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img_lab_eq<span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;CLAHE&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从结果可以看出，CLAHE 后的图像层次更丰富，阴影更清晰，轮廓更明显。看起来比单纯线性 alpha/beta 更“立体”，特别适合后期增强和细节分析。cv2.convertScaleAbs()的线性对比度增强，视觉效果上来说，图像整体变亮或整体对比增加，但阴影、暗部轮廓增强不明显。</p><figure><img src="`+f+`" alt="2.17 CHALE - Lab 亮度直方图均衡化" width="560" tabindex="0" loading="lazy"><figcaption>2.17 CHALE - Lab 亮度直方图均衡化</figcaption></figure><h4 id="_2-4-4-lab-色彩通道可视化" tabindex="-1"><a class="header-anchor" href="#_2-4-4-lab-色彩通道可视化"><span>2.4.4 Lab 色彩通道可视化</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 读取图像，转换格式，分离通道</span></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;01_lena.png&quot;</span><span class="token punctuation">)</span></span>
<span class="line">lab <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2LAB<span class="token punctuation">)</span></span>
<span class="line">L<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b <span class="token operator">=</span> cv2<span class="token punctuation">.</span>split<span class="token punctuation">(</span>lab<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可视化</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># L 通道（亮度）</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>L<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;L channel (Lightness)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&quot;off&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># a 通道（绿色 ↔ 洋红），cmap 的红绿映射 &quot;RdYlGn&quot;</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>a<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;a channel (Green &lt;-&gt; Magenta)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&quot;off&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># b 通道（蓝色 ↔ 黄色），camp 的蓝黄映射 &quot;coolwarm&quot;</span></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>b<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&quot;b channel (Blue &lt;-&gt; Yellow)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&quot;off&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>首先要说明一下灰度图，L 通道是灰度图很好理解，亮度信息嘛，只有明暗的变化，[0,100]的范围是 OpenCV 在内部对 [0,255]缩放得到的。</p><p>而 a、b 通道本身不是「颜色」的强度，而是「颜色倾向的偏移量」。[-128,127]这是数学上的定义，中心点为 0。OpenCV 将中心点放在了 128 这个值上，范围是 RGB 色域范围 [0,255]。越亮就代表数值越高。</p><figure><img src="`+x+'" alt="2.18 Lab 色彩通道分离1 灰度图" width="560" tabindex="0" loading="lazy"><figcaption>2.18 Lab 色彩通道分离1 灰度图</figcaption></figure><p>从更为清晰的彩色映射上来看：</p><ul><li>a 通道：大于 128 偏红；小于 128 偏绿。</li><li>b 通道：大于 128 偏黄；小于 128 偏蓝。</li></ul><figure><img src="'+w+`" alt="2.19 Lab 色彩通道分离2 彩色图" width="560" tabindex="0" loading="lazy"><figcaption>2.19 Lab 色彩通道分离2 彩色图</figcaption></figure><h2 id="_3-几何空间变换" tabindex="-1"><a class="header-anchor" href="#_3-几何空间变换"><span>3. 几何空间变换</span></a></h2><h3 id="_3-1-调整图像大小" tabindex="-1"><a class="header-anchor" href="#_3-1-调整图像大小"><span>3.1 调整图像大小</span></a></h3><h4 id="_3-1-1-cv2-resize-函数的基本参数" tabindex="-1"><a class="header-anchor" href="#_3-1-1-cv2-resize-函数的基本参数"><span>3.1.1 cv2.resize()函数的基本参数</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dsize<span class="token punctuation">,</span> fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> interpolation<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>src：输入图像。</li><li>dsize：输出图像的尺寸 (width, height)。如果指定了它，则忽略 fx 和 fy。</li><li>fx, fy：沿水平方向和垂直方向的缩放因子（浮点数）。</li><li>interpolation：插值算法的选择，最核心的参数。</li></ul><p>在 OpenCV 里内置的插值方法 一共有 8 种，<mark>最常用的缩小方法</mark>是 cv2.INTER_AREA 和 cv2.INTER_LINEAR（默认），<mark>最常见的放大方式</mark>为 cv2.INTER_CUBIC 和 cv2.INTER_LANCZOS4 ：</p><table><thead><tr><th>插值方式</th><th>宏定义</th><th>特点与应用</th></tr></thead><tbody><tr><td>最近邻插值</td><td>cv2.INTER_NEAREST(0)</td><td>速度最快，效果最差，像素风格或掩膜常用</td></tr><tr><td>双线性插值</td><td>cv2.INTER_LINEAR(1)</td><td>常用，速度与质量均衡，适合缩小或一般放大</td></tr><tr><td>双三次插值</td><td>cv2.INTER_CUBIC(2)</td><td>考虑 4×4 区域，质量比线性好，放大时效果更自然</td></tr><tr><td>区域插值</td><td>cv2.INTER_AREA(3)</td><td>缩小时效果最好，相当于做像素区域重采样，避免摩尔纹</td></tr><tr><td>Lanczos 插值</td><td>cv2.INTER_LANCZOS4(4)</td><td>使用 sinc 函数，锐度高，放大时细节保留最好</td></tr><tr><td>最近邻向下取整</td><td>cv2.INTER_LINEAR_EXACT(5)</td><td>类似 LINEAR，但计算更精确，OpenCV 3.4+ 才有</td></tr><tr><td>自动选择</td><td>cv2.INTER_NEAREST_EXACT(6)</td><td>OpenCV 4.5.0 引入的新选项，比 0 好用点</td></tr><tr><td>自动选择</td><td>cv2.INTER_MAX(7)</td><td>保留最大值（仅部分函数支持，内部用，不常用）</td></tr></tbody></table><h4 id="_3-1-2-按比例-固定尺寸-缩放" tabindex="-1"><a class="header-anchor" href="#_3-1-2-按比例-固定尺寸-缩放"><span>3.1.2 按比例/固定尺寸 缩放</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"></span>
<span class="line">image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;img_process_0/lena.png&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 替换你的图像路径</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><mark>按比例缩放 (Scale Factor)</mark>：直接通过比例因子（坐标轴百分比）调整图像大小，不关心具体像素大小。</li></ol><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">scale_x <span class="token operator">=</span> <span class="token number">0.5</span>  <span class="token comment"># 宽度缩小为 50%</span></span>
<span class="line">scale_y <span class="token operator">=</span> <span class="token number">0.5</span>  <span class="token comment"># 高度缩小为 50%</span></span>
<span class="line">resized <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> fx<span class="token operator">=</span>scale_x<span class="token punctuation">,</span> fy<span class="token operator">=</span>scale_y<span class="token punctuation">,</span> interpolation<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">original_height<span class="token punctuation">,</span> original_width <span class="token operator">=</span> image<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># 假设 Original Size: 512x512</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Original Size: </span><span class="token interpolation"><span class="token punctuation">{</span>original_width<span class="token punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token punctuation">{</span>original_height<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">resized_height<span class="token punctuation">,</span> resized_width <span class="token operator">=</span> resized<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># 则 Resized Size: 256x256</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Resized Size: </span><span class="token interpolation"><span class="token punctuation">{</span>resized_width<span class="token punctuation">}</span></span><span class="token string">x</span><span class="token interpolation"><span class="token punctuation">{</span>resized_height<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 OpenCV 中，<mark>img.shape</mark> 函数返回一个三元组：（高度，宽度，通道数）。因此，可以使用切片 [:2] 的方法，直接对高度、宽度进行赋值。</p><ul><li>shape[0]：表示图像的高度（rows，即行数）。</li><li>shape[1]：表示图像的宽度（columns，即列数）。</li><li>shape[2]：表示图像的通道数（例如 RGB 图像有 3 个通道）。</li></ul><ol start="2"><li><mark>固定尺寸调整 (Fixed Size)</mark>：直接设置目标尺寸。</li></ol><p>这种情况可能会导致图像变形，如果长宽比没有保持一致。就比如，还是 lena 图像，原本 512*512px，缩放到 300*200px。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">resized <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Scaled Image&#39;</span><span class="token punctuation">,</span> resized<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+R+`" alt="3.1 固定尺寸缩放，长宽比不一致时" width="240" tabindex="0" loading="lazy"><figcaption>3.1 固定尺寸缩放，长宽比不一致时</figcaption></figure><h4 id="_3-1-3-中心裁剪与边缘填充" tabindex="-1"><a class="header-anchor" href="#_3-1-3-中心裁剪与边缘填充"><span>3.1.3 中心裁剪与边缘填充</span></a></h4><p>在图像类的神经网络（深度学习）算法中，通常我们都会对图像数据集进行预处理。最常见的就是中心裁剪/边缘填充，因为很多算法需要正方形的图像，而我们收集到的数据很可能是矩形。</p><p>如果直接对矩形进行固定尺寸缩放，导致图像变形，会影响到神经网络的训练质量。那么，我们首先要做的就是<strong>固定一条边的尺寸，等比例缩放</strong>。</p><p><mark>如果是中心裁剪，固定短边的尺寸</mark>：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 固定短边尺寸进行等比例缩放</span></span>
<span class="line">original_height<span class="token punctuation">,</span> original_width <span class="token operator">=</span> image<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># 原始图像的 高宽</span></span>
<span class="line"></span>
<span class="line">width <span class="token operator">=</span> <span class="token number">1000</span>  <span class="token comment"># 假设是一张竖着的长图，短边为 width，设置目标大小为 1000</span></span>
<span class="line">height <span class="token operator">=</span> width <span class="token operator">*</span> original_height <span class="token operator">/</span> original_width  <span class="token comment"># 根据 width 计算目标长边 height</span></span>
<span class="line">resized <span class="token operator">=</span> cv2<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 进行缩放</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 中心裁剪（固定短边 → 正方形）</span></span>
<span class="line">center_x<span class="token punctuation">,</span> center_y <span class="token operator">=</span> new_width <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> new_height <span class="token operator">//</span> <span class="token number">2</span></span>
<span class="line">half <span class="token operator">=</span> width <span class="token operator">//</span> <span class="token number">2</span></span>
<span class="line">cropped <span class="token operator">=</span> resized<span class="token punctuation">[</span>center_y <span class="token operator">-</span> half<span class="token punctuation">:</span>center_y <span class="token operator">+</span> half<span class="token punctuation">,</span> center_x <span class="token operator">-</span> half<span class="token punctuation">:</span>center_x <span class="token operator">+</span> half<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 显示或保存</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&quot;Cropped&quot;</span><span class="token punctuation">,</span> cropped<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">&quot;test.png&quot;</span><span class="token punctuation">,</span> cropped<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><mark>如果是边缘填充，固定长边尺寸</mark>：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">target_long <span class="token operator">=</span> <span class="token number">1000</span>  <span class="token comment"># 固定长边尺寸为 1000</span></span>
<span class="line"></span>
<span class="line">top <span class="token operator">=</span> bottom <span class="token operator">=</span> <span class="token punctuation">(</span>target_long <span class="token operator">-</span> height<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span> <span class="token keyword">if</span> height <span class="token operator">&lt;</span> target_long <span class="token keyword">else</span> <span class="token number">0</span></span>
<span class="line">left <span class="token operator">=</span> right <span class="token operator">=</span> <span class="token punctuation">(</span>target_long <span class="token operator">-</span> width<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span> <span class="token keyword">if</span> width <span class="token operator">&lt;</span> target_long <span class="token keyword">else</span> <span class="token number">0</span></span>
<span class="line">padded <span class="token operator">=</span> cv2<span class="token punctuation">.</span>copyMakeBorder<span class="token punctuation">(</span></span>
<span class="line">    resized<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span></span>
<span class="line">    borderType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>BORDER_CONSTANT<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 黑边填充，可改为[255,255,255]</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="layout"><figure><img src="`+C+'" alt="3.2 中心裁剪" width="240" tabindex="0" loading="lazy"><figcaption>3.2 中心裁剪</figcaption></figure><figure><img src="'+G+`" alt="3.3 边缘填充" width="240" tabindex="0" loading="lazy"><figcaption>3.3 边缘填充</figcaption></figure></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">cropped <span class="token operator">=</span> resized<span class="token punctuation">[</span>center_y <span class="token operator">-</span> half<span class="token punctuation">:</span>center_y <span class="token operator">+</span> half<span class="token punctuation">,</span> center_x <span class="token operator">-</span> half<span class="token punctuation">:</span>center_x <span class="token operator">+</span> half<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>中心裁剪很好理解，OpenCV 读取到的图像数据，会转化为 Numpy 数组的格式，裁剪仅仅是对这个数组中的数据进行筛选。resized 对象是上一步进行缩放后得到的，找到 resized 的中心点，然后以短边为半径进行截取，就得到了中心裁剪后的图像。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">padded <span class="token operator">=</span> cv2<span class="token punctuation">.</span>copyMakeBorder<span class="token punctuation">(</span></span>
<span class="line">    src<span class="token punctuation">,</span> top<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span></span>
<span class="line">    borderType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>BORDER_CONSTANT<span class="token punctuation">,</span> value<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 黑边填充，可改为[255,255,255]</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>cv2.copyMakeBorder 函数的参数解析：</p><ol><li><p>src：表示需要被处理的图像对象，是一个 Numpy 数组；</p></li><li><p>top, bottom, left, right：分别表示上下左右需要增加的像素值；</p></li><li><p>borderType：表示指定的边框类型；常见的有以下几种：</p><ul><li>cv2.BORDER_CONSTANT(0): 添加常数值的边框，value 参数指定边框颜色或灰度值。</li><li>cv2.BORDER_REPLICATE(1): 复制图像中，最边缘的像素填充边界。</li><li>cv2.BORDER_REFLECT(2): 镜像反射边缘（不包括边缘像素本身）。</li><li>cv2.BORDER_WRAP(3): 用图像另一侧的像素填充边界（环绕）。</li><li>cv2.BORDER_REFLECT_101(4): 镜像反射边缘，包括边缘像素。</li></ul></li><li><p>value：指定边框的颜色或填充值，仅当 borderType 为 cv2.BORDER_CONSTANT 时有效。</p></li></ol><p>Padding 的默认填充方式 0 我们已经见过了，下面是 1、2、3 三种填充方式的视觉表示：</p><div class="layout"><figure><img src="`+L+'" alt="3.4 边缘填充-1" width="240" tabindex="0" loading="lazy"><figcaption>3.4 边缘填充-1</figcaption></figure><figure><img src="'+B+'" alt="3.5 边缘填充-2" width="240" tabindex="0" loading="lazy"><figcaption>3.5 边缘填充-2</figcaption></figure><figure><img src="'+q+`" alt="3.6 边缘填充-3" width="240" tabindex="0" loading="lazy"><figcaption>3.6 边缘填充-3</figcaption></figure></div><h4 id="_3-1-4-超分-计算机视觉的课题之一-超分辨率" tabindex="-1"><a class="header-anchor" href="#_3-1-4-超分-计算机视觉的课题之一-超分辨率"><span>3.1.4 超分：计算机视觉的课题之一 “超分辨率”</span></a></h4><p>OpenCV 包括 Pillow 的 resize 方法，本质上是 插值预测，并没有真正恢复细节。深度学习的 超分辨率（Super-Resolution, SR） 则通过训练模型，从低分辨率预测高分辨率的真实纹理。</p><p>缩小的方法，一般都用的是 resize 的方法。放大的话，如果分辨率差别不大，或者不需要很精细，也可以用差值算法，但是如果是 4 倍、8 倍的放大，建议使用超分算法。</p><h3 id="_3-2-旋转和仿射变换" tabindex="-1"><a class="header-anchor" href="#_3-2-旋转和仿射变换"><span>3.2 旋转和仿射变换</span></a></h3><h4 id="_3-2-1-cv2-rotate-函数-90-度角倍数的旋转。" tabindex="-1"><a class="header-anchor" href="#_3-2-1-cv2-rotate-函数-90-度角倍数的旋转。"><span>3.2.1 <mark>cv2.rotate</mark> 函数：90 度角倍数的旋转。</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;img_process_0/lena.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">rotated_90 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>ROTATE_90_CLOCKWISE<span class="token punctuation">)</span></span>
<span class="line">rotated_180 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>ROTATE_180<span class="token punctuation">)</span></span>
<span class="line">rotated_270 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>ROTATE_90_COUNTERCLOCKWISE<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Original&#39;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Rotated 90&#39;</span><span class="token punctuation">,</span> rotated_90<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Rotated 180&#39;</span><span class="token punctuation">,</span> rotated_180<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Rotated 270&#39;</span><span class="token punctuation">,</span> rotated_270<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在编程中，大多数参数的英文命名都是直译的，比如 CLOCKWISE 就代表顺时针，加上 ROTATE_90_，就代表顺时针方向旋转 90 度；而 COUNTERCLOCKWISE 表示逆时针，顺时针旋转 270 度，就等于逆时针旋转 90 度，一个意思。</p><div class="layout"><figure><img src="`+S+'" alt="3.7 旋转90度" width="240" tabindex="0" loading="lazy"><figcaption>3.7 旋转90度</figcaption></figure><figure><img src="'+z+'" alt="3.8 旋转180度" width="240" tabindex="0" loading="lazy"><figcaption>3.8 旋转180度</figcaption></figure><figure><img src="'+O+`" alt="3.9 旋转270度" width="240" tabindex="0" loading="lazy"><figcaption>3.9 旋转270度</figcaption></figure></div><h4 id="_3-2-2-cv2-getrotationmatrix2d-和-cv2-warpaffine-函数-任意角度的旋转。" tabindex="-1"><a class="header-anchor" href="#_3-2-2-cv2-getrotationmatrix2d-和-cv2-warpaffine-函数-任意角度的旋转。"><span>3.2.2 <mark>cv2.getRotationMatrix2D</mark> 和 <mark>cv2.warpAffine</mark> 函数：任意角度的旋转。</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;01_lena.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">(</span>h<span class="token punctuation">,</span> w<span class="token punctuation">)</span> <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># 获取图像宽高</span></span>
<span class="line"></span>
<span class="line">center <span class="token operator">=</span> <span class="token punctuation">(</span>w <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> h <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 获取图像中心坐标，“//”是整除运算，向下取整</span></span>
<span class="line">angle <span class="token operator">=</span> <span class="token number">45</span>  <span class="token comment"># 旋转度数设定</span></span>
<span class="line">scale <span class="token operator">=</span> <span class="token number">1.0</span>  <span class="token comment"># 缩放比例设定</span></span>
<span class="line">M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getRotationMatrix2D<span class="token punctuation">(</span>center<span class="token punctuation">,</span> angle<span class="token punctuation">,</span> scale<span class="token punctuation">)</span>  <span class="token comment"># 生成旋转矩阵</span></span>
<span class="line">M1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getRotationMatrix2D<span class="token punctuation">(</span>center<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">)</span></span>
<span class="line">M2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getRotationMatrix2D<span class="token punctuation">(</span>center<span class="token punctuation">,</span> angle<span class="token punctuation">,</span> scale<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 对旋转矩阵进行仿射变换，输出旋转后的图像</span></span>
<span class="line">rotated <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">rotated1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M1<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 调整旋转后的图像边界大小，np.abs()：取绝对值，确保结果为正数。</span></span>
<span class="line">cos <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>M<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># M[0, 0] 对应旋转矩阵中的 cos(θ)</span></span>
<span class="line">sin <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>M<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># M[0, 1] 对应旋转矩阵中的 sin(θ)</span></span>
<span class="line">new_w <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>h <span class="token operator">*</span> sin<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>w <span class="token operator">*</span> cos<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">new_h <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>h <span class="token operator">*</span> cos<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>w <span class="token operator">*</span> sin<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 调整旋转矩阵，由于旋转后图像的尺寸变大，原来的中心点需要平移到新的图像中心。</span></span>
<span class="line"><span class="token comment"># M[0, 2] 和 M[1, 2] 是仿射变换矩阵中的 平移项。</span></span>
<span class="line">M<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token punctuation">(</span>new_w <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">M<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token punctuation">(</span>new_h <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">rotated2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span>new_w<span class="token punctuation">,</span> new_h<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 仿射变换</span></span>
<span class="line"></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Original&#39;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Rotated&#39;</span><span class="token punctuation">,</span> rotated<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Rotated1&#39;</span><span class="token punctuation">,</span> rotated1<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Rotated2&#39;</span><span class="token punctuation">,</span> rotated2<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="layout"><figure><img src="`+I+'" alt="3.10 旋转45度，无缩放" width="240" tabindex="0" loading="lazy"><figcaption>3.10 旋转45度，无缩放</figcaption></figure><figure><img src="'+V+'" alt="3.11 旋转200度，缩放0.7" width="240" tabindex="0" loading="lazy"><figcaption>3.11 旋转200度，缩放0.7</figcaption></figure><figure><img src="'+P+`" alt="3.12 旋转45度，边界调整" width="240" tabindex="0" loading="lazy"><figcaption>3.12 旋转45度，边界调整</figcaption></figure></div><p>代码给出了两种保留完整图像的方式，rotated1 是对旋转后的图像进行了缩小，而 rotated2 是对旋转后的图像扩展了边界。</p><p><mark>cv2.getRotationMatrix2D</mark> 的作用是，生成一个二维旋转的仿射变换矩阵（2×3）。它本身并不会改变图像内容。<mark>cv2.warpAffine</mark> 的作用是，对图像应用仿射变换（包括旋转、缩放、平移等）。这里才真正执行变换，把原图像按照矩阵 M 进行旋转/缩放/平移。</p><h3 id="_3-3-镜像翻转" tabindex="-1"><a class="header-anchor" href="#_3-3-镜像翻转"><span>3.3 镜像翻转</span></a></h3><p>在 OpenCV 中，可以使用 <mark>cv2.flip</mark> 函数对图像进行 <strong>镜像翻转</strong> 操作。cv2.flip 支持以下三种翻转方式：</p><ul><li>水平翻转（左右镜像）：flipCode = 1</li><li>垂直翻转（上下镜像）：flipCode = 0</li><li>水平 + 垂直翻转（180° 翻转）：flipCode = -1</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;img_process_0/lena.png&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">flipped_h <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">flipped_v <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">flipped_hv <span class="token operator">=</span> cv2<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Original&#39;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Horizontal Flip&#39;</span><span class="token punctuation">,</span> flipped_h<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Vertical Flip&#39;</span><span class="token punctuation">,</span> flipped_v<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Both Flip&#39;</span><span class="token punctuation">,</span> flipped_hv<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="layout"><figure><img src="`+E+'" alt="3.13 水平翻转" width="240" tabindex="0" loading="lazy"><figcaption>3.13 水平翻转</figcaption></figure><figure><img src="'+A+'" alt="3.14 垂直翻转" width="240" tabindex="0" loading="lazy"><figcaption>3.14 垂直翻转</figcaption></figure><figure><img src="'+H+`" alt="3.15 水平+垂直翻转" width="240" tabindex="0" loading="lazy"><figcaption>3.15 水平+垂直翻转</figcaption></figure></div><h3 id="_3-4-透视变换" tabindex="-1"><a class="header-anchor" href="#_3-4-透视变换"><span>3.4 透视变换</span></a></h3><p>透视变换（Perspective Transform）是一种常见的图像几何变换，可以模拟摄像机视角变化、斜拍、投影等效果。与仿射变换相比，透视变换不仅能实现平移、旋转、缩放，还能让图像发生“倾斜”、“拉伸”，比如将矩形变成梯形。它在文档矫正、车道线检测、AR 增强现实等场景中非常实用。</p><p>透视变换的数学基础是单应性矩阵（Homography），即一个 3×3 的变换矩阵。通过指定原图像的四个点和目标图像的四个点，OpenCV 可以自动计算出变换矩阵，并完成图像的投影变换。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;poker.jpeg&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 原图像上的四个点（比如选取一个矩形区域的四个顶点）</span></span>
<span class="line">pts1 <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">112</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">252</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">193</span><span class="token punctuation">,</span> <span class="token number">275</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">230</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 目标图像上的四个点（变换后的位置，可以是任意四边形）</span></span>
<span class="line">pts2 <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">280</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">280</span><span class="token punctuation">,</span> <span class="token number">380</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">380</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getPerspectiveTransform<span class="token punctuation">(</span>pts1<span class="token punctuation">,</span> pts2<span class="token punctuation">)</span>  <span class="token comment"># 计算透视变换矩阵</span></span>
<span class="line">result <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpPerspective<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 应用透视变换</span></span>
<span class="line"></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Original&#39;</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Perspective Transform&#39;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="layout"><figure><img src="`+j+'" alt="3.16 透视变换-原图" width="240" tabindex="0" loading="lazy"><figcaption>3.16 透视变换-原图</figcaption></figure><figure><img src="'+T+'" alt="3.17 透视变换-新图" width="240" tabindex="0" loading="lazy"><figcaption>3.17 透视变换-新图</figcaption></figure></div>',180)]))}const K=s(M,[["render",N]]),Y=JSON.parse('{"path":"/series/ComputerVision/ImageProcessing/02_jichucaozuo.html","title":"基础操作","lang":"en-US","frontmatter":{"title":"基础操作","date":"2025/09/03","categories":["图像处理"],"tags":["OpenCV","格式转换","几何空间变换","色彩空间变换"]},"headers":[{"level":2,"title":"1. Hello, OpenCV!","slug":"_1-hello-opencv","link":"#_1-hello-opencv","children":[{"level":3,"title":"1.1 读取写入","slug":"_1-1-读取写入","link":"#_1-1-读取写入","children":[]},{"level":3,"title":"1.2 数据类型","slug":"_1-2-数据类型","link":"#_1-2-数据类型","children":[]},{"level":3,"title":"1.3 显示方式","slug":"_1-3-显示方式","link":"#_1-3-显示方式","children":[]},{"level":3,"title":"1.4 格式转换","slug":"_1-4-格式转换","link":"#_1-4-格式转换","children":[]}]},{"level":2,"title":"2. 色彩空间变换","slug":"_2-色彩空间变换","link":"#_2-色彩空间变换","children":[{"level":3,"title":"2.1 cv2.cvtColor()","slug":"_2-1-cv2-cvtcolor","link":"#_2-1-cv2-cvtcolor","children":[]},{"level":3,"title":"2.2 RGB 色彩空间","slug":"_2-2-rgb-色彩空间","link":"#_2-2-rgb-色彩空间","children":[]},{"level":3,"title":"2.3 HSV 色彩空间","slug":"_2-3-hsv-色彩空间","link":"#_2-3-hsv-色彩空间","children":[]},{"level":3,"title":"2.4 Lab 色彩空间","slug":"_2-4-lab-色彩空间","link":"#_2-4-lab-色彩空间","children":[]}]},{"level":2,"title":"3. 几何空间变换","slug":"_3-几何空间变换","link":"#_3-几何空间变换","children":[{"level":3,"title":"3.1 调整图像大小","slug":"_3-1-调整图像大小","link":"#_3-1-调整图像大小","children":[]},{"level":3,"title":"3.2 旋转和仿射变换","slug":"_3-2-旋转和仿射变换","link":"#_3-2-旋转和仿射变换","children":[]},{"level":3,"title":"3.3 镜像翻转","slug":"_3-3-镜像翻转","link":"#_3-3-镜像翻转","children":[]},{"level":3,"title":"3.4 透视变换","slug":"_3-4-透视变换","link":"#_3-4-透视变换","children":[]}]}],"git":{"createdTime":1757688790000,"updatedTime":1757688790000,"contributors":[{"name":"jinkai","email":"1213860588@qq.com","commits":1}]},"filePathRelative":"series/ComputerVision/ImageProcessing/02_基础操作.md"}');export{K as comp,Y as data};
