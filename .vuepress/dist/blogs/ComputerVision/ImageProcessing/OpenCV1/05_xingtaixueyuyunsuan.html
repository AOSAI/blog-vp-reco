<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>05-形态学与运算 | AoSaiX</title><meta name="description" content="Blog for study, life and hobby.">
    <link rel="preload" href="/blog-vp-reco/assets/style-CO2hMFE6.css" as="style"><link rel="stylesheet" href="/blog-vp-reco/assets/style-CO2hMFE6.css">
    <link rel="modulepreload" href="/blog-vp-reco/assets/app-CkYqgEgS.js"><link rel="modulepreload" href="/blog-vp-reco/assets/05_xingtaixueyuyunsuan.html-vern5NzA.js">
    <link rel="prefetch" href="/blog-vp-reco/assets/timeline.html-BmBUTgHe.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/posts.html-CI4W8hf-.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/friendship-link.html-B9HP9khK.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/custom-page.html-BH_a5EiX.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-waI05CeC.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/2.html-DjrOAqw9.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DCPtBVjg.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/2.html-D3_6I-iV.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/3.html-DbtFjr08.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-AynghZXz.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-CJG6L0bz.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-BVQFBV45.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/2.html-B4y4Az9o.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-CgYmwuWP.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-BApawDc8.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-BMMlMe9W.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-CPI2J9FJ.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-C_wEy4nC.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-D0Rp9O8J.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-yKoM0bi3.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-ChuHEt9i.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-D3fuX-rV.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-0aHlg64C.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-BHdRO4_5.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/2.html-q48LshFL.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/3.html-2slaq1rY.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DQu0RLLI.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/2.html-CgTKBhKY.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/3.html-D5HOUw8V.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-J-uEa357.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DkR3A7Aa.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-lg4ds7mY.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DU4BauGk.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-B0EBlI5c.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-CWNy052E.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DHBa6p58.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-3mLsGx1d.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-jdsphMIk.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-ClRI3Jir.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-BL14h2f7.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-CKw9Onmr.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-Cc32G9tF.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-BK_Qd6vB.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-CS3NS-ls.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-HERZuIol.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-CeFn8Ija.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DhsGvrIC.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DdxMwKai.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DMf9X8nX.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-ChX6LQ0H.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-UkuIakgO.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-Oc_E4pFE.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-B94NKQSZ.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-CVDCG-XT.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-vR-Rhdom.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-1WRsFfSs.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DTKakW9D.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-CCOQw3X9.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-BSAlReAi.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-BYoJilFh.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-mUGXFKGk.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-BW-kE79j.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DT85tFes.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-nEgUI6dd.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-D7s95_hi.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-KXdfDL9b.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-BmbN8R4w.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-vWWbPu8u.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-CuAbJyQP.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/1.html-DKuEZ_6T.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/2.html-BtcnX543.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/3.html-C7y2ptfl.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/4.html-DX4w-3PX.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/5.html-DXHEGRGL.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/6.html-BCCG9CyT.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/7.html-4RuDE0ZS.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/index.html-CZPamI9K.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/update_record.html-BLEPbT20.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/vuepress-recojiaocheng.html-3kdOUqtO.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01_compress_photo.html-CFhsPkhT.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/02_file_packaging.html-CHN4lHcV.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/03_pyqt5_recording.html-BkbhO1ma.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/04_spider_for_ticket.html--AjUcc-n.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/index.html-DCxerK2H.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/Introduction.html-By4V-AHL.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01_zongshu.html-Jrwto47R.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/02_tuxiangxiufurumen.html-DIm39Mg7.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/03_xxx.html-CLbzJNed.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/Introduction.html-C43FAG3J.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01_zongshu.html--DBxVvAy.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/02_xxx.html-vtHMDiXW.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/03_xxx.html-B9pLt7FQ.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01_xxx.html-DmsJCxwy.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/02_xxx.html-CfbGy3Er.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01_bairuzongmen.html-CrM15YF8.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/02_aolianjingu.html-BOGYM37j.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01_base.html-BLqngXnu.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/02_project1.html-CU_LRy_b.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/02_project2.html-D3ZTnlnr.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/03_project1.html-jtdXKwSa.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/index.html-JZxF2-bS.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01_fargoing.html-imyzyYks.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/02_shanxi.html-BRJsE5Dd.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/03_sichuan.html-Dfaxfocr.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/00.html-z90ODlNN.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01.html-DRNS3VzL.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/00_introduction.html-Sm8UlekP.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01_recommend_model.html-DC7pYJFH.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01_introduction.html-CVu_nDCl.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/02_linear_regression.html-rIBLm-dr.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/03_linear_regression.html-DEDaaQ9P.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/04_classification.html-CwQXD7XM.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/05_deep_learning.html-TrgjbOXu.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/06_tensorflow.html-seWODz8B.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/07_model_evaluation.html-CdZXZtSZ.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/08_decision_tree.html-LQe2pNlb.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/09_unsupervised_learning.html-BD5pmdtV.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/10_recommendation_system.html-BsStN-Xx.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/11_reinforcement_learning.html-BKIdZzOn.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/ML1.html-CuMdtcbu.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA1.html-BVTXtCEv.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA10.html-NYeRyOWl.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA11.html-BSsZOD2n.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA12.html-DM1l4uLk.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA13.html-BbSA7S5H.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA14.html-G-gVDLG5.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA15.html-C2LzYfhO.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA16.html-dUkxC_Vz.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA17.html-SrCsbK4l.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA18.html-pVD16DZV.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA19.html-EdttqIQl.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA2.html-BrwDyWzK.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA20.html-e2Bbw-fk.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA3.html-Lo1-tQzj.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA4.html-DRTqPfsb.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA5.html-BNv9k4M0.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA6.html-BDIZ7b8F.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA7.html-DAlfg2AH.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA8.html-76jnmz0r.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/LA9.html-DVLs0AfL.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/20_xinhaoyutuxiang.html-BKkwGTOw.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/30_xinhaoyutuxiang.html-UbvwCzbS.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/01_zongshu.html-C4hzgU2P.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/02_jichucaozuo.html-BDUMF-DK.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/03_zaoshengyulvbo.html-Cm6MnPaV.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/04_ruihuayujunhenghua.html-BqXk4-Gj.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/06_yuzhiyulunkuo.html-CRiSO9UD.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/07_xinhaoyutuxiang.html-DqGoJFij.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/08_shipinliuchuli.html-CnybAPtu.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/09_yasuoyubianma.html-UYZcgSsx.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/10_huizhituxingyuwenben.html-Bd4Byvx8.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/11_tezhengyuARzengqiang.html-DbJRkKei.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/12_guangliuyuyundongfenxi.html-buywWHtO.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/404.html-D_REzjgJ.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/Valine.min-_LyT3bfY.js" as="script"><link rel="prefetch" href="/blog-vp-reco/assets/giscus-aTimukGI-DWEKOTfS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container show-series show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/blog-vp-reco/logo1.svg" alt="AoSaiX"><a href="/blog-vp-reco/" class="site-name can-hide">AoSaiX</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="机器学习"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->机器学习<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="机器学习"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->机器学习<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/MachineLearning/MachineLearning/01_introduction" class="link" aria-label="机器学习(未整理)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->机器学习(未整理)<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/MachineLearning/recommendationSystem/00_introduction" class="link" aria-label="推荐系统(未整理)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->推荐系统(未整理)<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="数据锻造坊"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据锻造坊<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="数据锻造坊"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据锻造坊<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/DataFoundry/Numpy/01_拜入宗门" class="link" aria-label="Numpy"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Numpy<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/DataFoundry/Matplotlib/01_xxx" class="link" aria-label="Matplotlib"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Matplotlib<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="深度学习"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->深度学习<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="深度学习"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->深度学习<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/DeepLearning/PyTorch/README.md" class="link" aria-label="PyTorch(未整理)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->PyTorch(未整理)<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="计算机视觉"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->计算机视觉<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="计算机视觉"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->计算机视觉<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/01_综述" class="link" aria-label="图像处理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->图像处理<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/ComputerVision/ImageGeneration/01_综述" class="link" aria-label="图像生成"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->图像生成<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/ComputerVision/TargetDetection/01_综述" class="link" aria-label="目标检测"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->目标检测<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="每日一题"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->每日一题<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="每日一题"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->每日一题<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/CodeExam/AI/Introduction" class="link" aria-label="AI算法篇"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->AI算法篇<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="书院二层楼"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->书院二层楼<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="书院二层楼"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->书院二层楼<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><!--[--><h5 class="dropdown-link__subtitle"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Reco内置<!--]--></span></span></h5><ul class="dropdown-link__subcontainer"><!--[--><li class="dropdown-link__subitem"><a href="/blog-vp-reco/timeline" class="link" aria-label="时间轴"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->时间轴<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__subitem"><a href="/blog-vp-reco/friendship-link" class="link" aria-label="友情链接"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->友情链接<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-link__item"><!--[--><h5 class="dropdown-link__subtitle"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->个人手札<!--]--></span></span></h5><ul class="dropdown-link__subcontainer"><!--[--><li class="dropdown-link__subitem"><a href="/blog-vp-reco/docs/update_record" class="link" aria-label="更新日志"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->更新日志<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__subitem"><a href="/blog-vp-reco/docs/desktop_app/README.md" class="link" aria-label="桌面软件开发(未整理)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->桌面软件开发(未整理)<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="逐趣成章"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->逐趣成章<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="逐趣成章"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->逐趣成章<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/Hobbies/mahjong/01_fargoing" class="link" aria-label="雀神之路(未整理)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->雀神之路(未整理)<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blog-vp-reco/blogs/Hobbies/musictheroy/00" class="link" aria-label="音乐科学(未整理)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->音乐科学(未整理)<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><header class="sub-navbar-container not-open"><span class="nav-item"><div class="toggle-series-button" aria-expanded="false" role="button" tabindex="0"><span></span><span></span><span></span></div> Series </span></header><!----><!----><div class="theme-main" style=""><aside class="series-container"><!--[--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1 active"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->OpenCV 入门<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/01_zongshu.html" class="link series-item series-item" aria-label="01-图像处理综述"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->01-图像处理综述<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/02_jichucaozuo.html" class="link series-item series-item" aria-label="02-基础操作"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->02-基础操作<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/03_zaoshengyulvbo.html" class="link series-item series-item" aria-label="03-噪声与平滑化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->03-噪声与平滑化<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/04_ruihuayujunhenghua.html" class="link series-item series-item" aria-label="04-锐化与均衡化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->04-锐化与均衡化<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html" class="router-link-active router-link-exact-active link router-link-active series-item series-item" aria-label="05-形态学与运算"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->05-形态学与运算<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/06_yuzhiyulunkuo.html" class="link series-item series-item" aria-label="06-阈值分割与边缘检测"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->06-阈值分割与边缘检测<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/07_xinhaoyutuxiang.html" class="link series-item series-item" aria-label="07-信号与图像"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->07-信号与图像<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/08_shipinliuchuli.html" class="link series-item series-item" aria-label="08-视频流处理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->08-视频流处理<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/09_yasuoyubianma.html" class="link series-item series-item" aria-label="09-压缩与编码"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->09-压缩与编码<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/10_huizhituxingyuwenben.html" class="link series-item series-item" aria-label="10-绘制图形与文本"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->10-绘制图形与文本<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/11_tezhengyuARzengqiang.html" class="link series-item series-item" aria-label="11-特征与AR增强"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->11-特征与AR增强<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/12_guangliuyuyundongfenxi.html" class="link series-item series-item" aria-label="12-光流与运动分析"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->12-光流与运动分析<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->OpenCV 进阶<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV2/20_xinhaoyutuxiang.html" class="link series-item series-item" aria-label="信号与图像"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->信号与图像<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->OpenCV 实战<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV3/30_xinhaoyutuxiang.html" class="link series-item series-item" aria-label="信号与图像"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->信号与图像<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--]--></aside><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">05-形态学与运算</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->AoSaiX<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025/10/16<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/blog-vp-reco/categories/OpenCV/1.html" class="">OpenCV</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/blog-vp-reco/tags/tuxiangchuli/1.html" class="">图像处理</a><a href="/blog-vp-reco/tags/xingtaixueyuyunsuan/1.html" class="">形态学与运算</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><h2 id="_1-运算类操作" tabindex="-1"><a class="header-anchor" href="#_1-运算类操作"><span>1. 运算类操作</span></a></h2><h3 id="_1-1-饱和运算" tabindex="-1"><a class="header-anchor" href="#_1-1-饱和运算"><span>1.1 饱和运算</span></a></h3><p>饱和运算的原理十分简单，比如我们正常 RGB 的像素范围在 [0, 255] 之间，但是有的时候，做了加法、减法等等，导致其越界了。怎么办呢？<strong>OpenCV 的处理方式</strong>：会直接将值截断在边界值，小于 0 的被置为 0，大于 255 的被置为 255。</p><p>所以 <mark>饱和运算（Saturated Operation）</mark> 在实现上就是通过最大值与最小值将运算限制在固定范围之内。我们先用 Python 的方法来做一个演示，通过 min 和 max 函数来截断：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">opencv_add1</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    temp <span class="token operator">=</span> a <span class="token operator">+</span> b</span>
<span class="line">    <span class="token keyword">return</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">opencv1 <span class="token operator">=</span> opencv_add1<span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;opencv add 1: &quot;</span><span class="token punctuation">,</span> opencv1<span class="token punctuation">)</span>  <span class="token comment"># 255</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但需要注意的是，OpenCV 的底层是 Numpy 数组，所以如果真实的要去做操作，需要使用 <mark>np.clip()</mark> 函数进行截断，或者直接使用 where 条件判断也可以：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">opencv_add2</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 1. 先将输入转换为更大的整数类型（比如 int32），防止中间计算溢出</span></span>
<span class="line">    img1_int32 <span class="token operator">=</span> a<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span></span>
<span class="line">    img2_int32 <span class="token operator">=</span> b<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 2. 使用 clip 函数手动饱和处理，裁剪到 [0, 255] 范围</span></span>
<span class="line">    result_int32 <span class="token operator">=</span> img1_int32 <span class="token operator">+</span> img2_int32</span>
<span class="line">    result_clipped <span class="token operator">=</span> np<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>result_int32<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 3. 最后再转换回 uint8 返回</span></span>
<span class="line">    <span class="token keyword">return</span> result_clipped<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">opencv2 <span class="token operator">=</span> numpy_add<span class="token punctuation">(</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">250</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  np<span class="token punctuation">.</span>uint8<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;opencv add 2: &quot;</span><span class="token punctuation">,</span> opencv2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此外，np.uint8 在内存中占用 1 个字节（8 位），只能表示 0 到 255 这 256 个整数，在溢出后它的默认规撞上了 C 语言层面的整数溢出规则，也就是进行回绕的<strong>模运算</strong>：把 0 和 255 收尾相连，形成一个圆形环路。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"></span>
<span class="line">x <span class="token operator">=</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">250</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">y <span class="token operator">=</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">opencv <span class="token operator">=</span> cv2<span class="token punctuation">.</span>add<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>  <span class="token comment"># 250 + 50 = 300 -&gt; 255</span></span>
<span class="line">numpy <span class="token operator">=</span> x <span class="token operator">+</span> y  <span class="token comment"># 250 + 50 = 300 -&gt; 44 (mod 256)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;opencv:\n&quot;</span><span class="token punctuation">,</span> opencv<span class="token punctuation">)</span>  <span class="token comment"># 饱和运算</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;numpy:\n&quot;</span><span class="token punctuation">,</span> numpy<span class="token punctuation">)</span>  <span class="token comment"># 模运算</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在我的例子中就是 mod 256。这种 Numpy 的模运算，和 OpenCV 的饱和运算是两码事儿，不要混淆了。</p><h3 id="_1-2-图像加减法" tabindex="-1"><a class="header-anchor" href="#_1-2-图像加减法"><span>1.2 图像加减法</span></a></h3><p>图像的加减法分别使用 <mark>cv2.add()</mark>、<mark>cv2.subtract()</mark> 两个函数执行，如果读取的内容是图像，它们在内部会自动执行饱和运算。当然，从实现上来说，这两个函数不仅可以用于数组的逐元素运算，也可以对标量运算。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;01_luna.png&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 读取图像</span></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span></span>
<span class="line">M <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">&quot;uint8&quot;</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255</span></span>
<span class="line"></span>
<span class="line">result1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>add<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M<span class="token punctuation">)</span></span>
<span class="line">result2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>img<span class="token punctuation">,</span> M<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token string">&quot;Original Image&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>result1<span class="token punctuation">,</span> <span class="token string">&quot;Add 255&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>result2<span class="token punctuation">,</span> <span class="token string">&quot;Subtract 255&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/01_addsub1.png" alt="1.1 图像加减法越界结果" tabindex="0" loading="lazy"><figcaption>1.1 图像加减法越界结果</figcaption></figure><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/02_addsub2.png" alt="1.2 图像加减法正常结果" tabindex="0" loading="lazy"><figcaption>1.2 图像加减法正常结果</figcaption></figure><h3 id="_1-3-图像混合" tabindex="-1"><a class="header-anchor" href="#_1-3-图像混合"><span>1.3 图像混合</span></a></h3><p>图像混合也是图像相加的一种，只不过可以赋予不同图像不同的权重进行相加。没错，就是我们的老朋友 <mark>cv2.addWeighted()</mark> 函数，在《锐化与均衡化》中已经见过面了：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">dst <span class="token operator">=</span> cv2<span class="token punctuation">.</span>addWeighted<span class="token punctuation">(</span>src1<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> src2<span class="token punctuation">,</span> beta<span class="token punctuation">,</span> gamma<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>d</mi><mi>s</mi><mi>t</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><mi>r</mi><mi>c</mi><mn>1</mn><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>α</mi><mo>+</mo><mi>s</mi><mi>r</mi><mi>c</mi><mn>2</mn><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>β</mi><mo>+</mo><mi>γ</mi></mrow><annotation encoding="application/x-tex">dst(x,y)=src1(x,y)\cdot{\alpha}+src2(x,y)\cdot{\beta}+\gamma </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">src</span><span class="mord">1</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">src</span><span class="mord">2</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span></span></p><p>那我们就再来一个老熟人 <mark>Sobel 算子</mark>，看一下 X 方向、Y 方向、XY 混合方向，边缘检测的结果分别是什么：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;01_luna.png&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 读取图像</span></span>
<span class="line">gradient_x <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CV_32F<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">gradient_y <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CV_32F<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">gradient_xy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>magnitude<span class="token punctuation">(</span>gradient_x<span class="token punctuation">,</span> gradient_y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>gradient_x<span class="token punctuation">,</span> <span class="token string">&quot;Gradient X Float32&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>gradient_y<span class="token punctuation">,</span> <span class="token string">&quot;Gradient Y Float32&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>gradient_xy<span class="token punctuation">,</span> <span class="token string">&quot;Gradient XY Float32&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>convertScaleAbs<span class="token punctuation">(</span>gradient_x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Gradient X uint8&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>convertScaleAbs<span class="token punctuation">(</span>gradient_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Gradient Y uint8&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>convertScaleAbs<span class="token punctuation">(</span>gradient_xy<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Gradient XY uint8&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/03_max1.png" alt="1.3 Sobel 算子 - 不同方向的梯度显示 浮点数" tabindex="0" loading="lazy"><figcaption>1.3 Sobel 算子 - 不同方向的梯度显示 浮点数</figcaption></figure><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/04_max2.png" alt="1.4 Sobel 算子 - 不同方向的梯度显示 正整数" tabindex="0" loading="lazy"><figcaption>1.4 Sobel 算子 - 不同方向的梯度显示 正整数</figcaption></figure><h3 id="_1-4-按位运算" tabindex="-1"><a class="header-anchor" href="#_1-4-按位运算"><span>1.4 按位运算</span></a></h3><p>在 OpenCV 中，按位运算的函数一共有四个：<strong>与（and）、或（or）、非（not）、异或（xor）</strong>，每一个都很常用：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>src1<span class="token punctuation">,</span> src2<span class="token punctuation">,</span> dst<span class="token operator">=</span>dst<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>bitwise_or<span class="token punctuation">(</span>src1<span class="token punctuation">,</span> src2<span class="token punctuation">,</span> dst<span class="token operator">=</span>dst<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>bitwise_xor<span class="token punctuation">(</span>src1<span class="token punctuation">,</span> src2<span class="token punctuation">,</span> dst<span class="token operator">=</span>dst<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">cv2<span class="token punctuation">.</span>bitwise_not<span class="token punctuation">(</span>src<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可选参数 <strong>dst</strong> 用来指定输出的目标数组，通常在优化内存或者高性能储存时使用；可选参数 <strong>mask</strong> 用来指定按位运算的区域，黑白二值图像，黑色部分代表不处理的区域，白色部分代表需要做按位运算的区域。</p><ol><li><strong>按位与</strong>：两个像素同时为“真”时，结果才为“真”。<strong>常用于</strong> 提取 ROI（感兴趣区域）。用一个掩膜（mask）与原图进行与操作，可以抠出掩膜区域的图像。</li></ol><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/05_and.png" alt="1.5 按位与运算 AND" tabindex="0" loading="lazy"><figcaption>1.5 按位与运算 AND</figcaption></figure><ol start="2"><li><strong>按位非</strong>：反转每一位，即“求反”或“取补”。<strong>常用于</strong> 反转掩膜、生成负片。</li></ol><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/05_not.png" alt="1.6 按位非运算 AND" tabindex="0" loading="lazy"><figcaption>1.6 按位非运算 AND</figcaption></figure><ol start="3"><li><strong>按位或</strong>：两个像素中任意一个为“真”时，结果就为“真”。<strong>常用于</strong> 合并图像或区域。</li></ol><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/05_or.png" alt="1.7 按位或运算 OR" tabindex="0" loading="lazy"><figcaption>1.7 按位或运算 OR</figcaption></figure><ol start="4"><li><strong>按位异或</strong>：两个像素值不同时，结果为“真”；相同时，结果为“假”。<strong>常用于</strong> 找不同（检测区域变化）、绘制对称图形、加密/解密。</li></ol><p>假设有一家公司的仓库进小偷了，但是一时间不知道被偷了什么东西，不过幸好仓库的摄像头全程开启，所以我们通过前后不同时间的对比，找到了什么东西被拿走了（就是小孩子玩的找不同）。</p><p>直接减图会得到有正有负的差异，不方便处理。而 XOR 只关心“是否不同”，不关心谁亮谁暗，结果更二值化，便于后续分析。</p><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/05_xor.png" alt="1.8 按位异或运算 XOR" tabindex="0" loading="lazy"><figcaption>1.8 按位异或运算 XOR</figcaption></figure><p>这里之所以有重影是因为我截图的时候，有些许误差，人眼不好分辨。不过很明显，五处不同颜色很鲜艳，误差的重影就只有轮廓。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->按位与 AND<!--]--></span></span></button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->按位非 NOT<!--]--></span></span></button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->按位或 OR<!--]--></span></span></button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->按位异或 XOR<!--]--></span></span></button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;04_cafe.jpg&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">img2 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">960</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">280</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">bitwise_and <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Original Image&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Comparsion Image&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>bitwise_and<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;AND Result&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;04_cafe.jpg&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">img2 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">960</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">280</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">bitwise_not <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_not<span class="token punctuation">(</span>img2<span class="token punctuation">)</span></span>
<span class="line">bitwise_and <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> bitwise_not<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Original Image&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>bitwise_not<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;NOT Result&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>bitwise_and<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;AND Result&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;04_cafe.jpg&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">img2 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">960</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">280</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">img3 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img3<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">460</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">bitwist_or <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_or<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> img3<span class="token punctuation">)</span></span>
<span class="line">bitwise_and <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> bitwist_or<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Original Image&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Original Image&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img3<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Original Image&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>bitwist_or<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;NOT Result&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>bitwise_and<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;AND Result&quot;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;03_zbt1.jpg&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;03_zbt2.jpg&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">bitwise_xor <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_xor<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Original Image&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Comparsion Image&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>bitwise_xor<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2RGB<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;XOR Result&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><h2 id="_2-形态学操作" tabindex="-1"><a class="header-anchor" href="#_2-形态学操作"><span>2. 形态学操作</span></a></h2><p>形态学运算是一种基于形状的图像处理技术，它是通过结构元素与图像进行特定运算的方式来改变图像的形态和特征。结构元素是一种小型、预定义的形状，通常是矩形、圆形或者椭圆形，可以与图像中的像素进行匹配。在图像处理中应用广泛，特别是在图像分割、边缘检测、文本识别、计算机视觉等领域中。</p><p>形态学运算包括膨胀、腐蚀、开运算、闭运算等。其中膨胀操作可以将图像中的物体变大，使它更加连通；腐蚀操作则可以将图像中的物体变小，使它更加细化；开运算可以去除噪声，平滑图像的边缘；闭运算可以填补图像中物体的孔洞。</p><h3 id="_2-1-膨胀与腐蚀" tabindex="-1"><a class="header-anchor" href="#_2-1-膨胀与腐蚀"><span>2.1 膨胀与腐蚀</span></a></h3><p><mark>膨胀（dilate）</mark> 通常用于 <strong>填补空洞</strong>，物体内部的小孔洞会被填充；<strong>连接断线</strong>，断裂的线条会被连接起来；<strong>边缘扩张</strong>，让物体的边缘向外扩展。</p><p><mark>腐蚀（erode）</mark> 通常用于 <strong>去除小噪点</strong>，细小的白色噪点会被完全腐蚀掉；<strong>分离粘连物体</strong>，轻微腐蚀可以让轻微粘连的物体分开；<strong>边缘细化</strong>，让物体的边缘向内收缩。</p><p>但也需要注意，过度腐蚀可能会导致 “有用的物体会变小甚至消失”，“纤细的特征（如文字笔画）可能被腐蚀断”，所以要谨慎处理，尤其是要谨慎选择迭代次数。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>src<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> dst<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> anchor<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> borderType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>BORDER_CONSTANT<span class="token punctuation">,</span> borderValue<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>erode<span class="token punctuation">(</span>src<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> dst<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> anchor<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> borderType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>BORDER_CONSTANT<span class="token punctuation">,</span> borderValue<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>必须的参数有 2 个，可选参数中有 1 个比较常用：</p><ul><li><strong>src 输入图像</strong>：想要处理的原始图片。</li><li><strong>kernel 结构元素（核）</strong>：形态学操作的&quot;刷子&quot;。默认矩形的话，可以直接用 np 生成一个数组。</li><li><strong>iterations 迭代次数（重要可选）</strong>：执行腐蚀/膨胀的次数，默认=1。</li></ul><p>不怎么重要，通常可以省略的可选参数：<strong>dst</strong> 输出的目标，按位操作中也有。<strong>anchor</strong> 核的锚点位置，默认=(-1, -1)，表示核的中心，几乎永远不需要改。<strong>borderType</strong>、<strong>borderValue</strong> 边界类型与边界值。</p><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/06_ed1.png" alt="2.1 Sobel 算子 - 腐蚀与膨胀" tabindex="0" loading="lazy"><figcaption>2.1 Sobel 算子 - 腐蚀与膨胀</figcaption></figure><p>腐蚀是<strong>用核内最小值替换中心像素</strong>，所以它更偏爱黑色，如果绝大部分都是黑色，会把白色都消灭掉。而膨胀是<strong>用核内最大值替换中心像素</strong>，所以他更偏爱白色，消灭黑色会让区域变得更白。</p><p>诶！有点意思，所以如果是黑色背景的白色噪声，腐蚀可以消除，但是反过来如果白色背景里有黑色噪声，腐蚀反而会增大噪声？我们来试试看：</p><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/06_ed2.png" alt="2.2 腐蚀性质的探究" tabindex="0" loading="lazy"><figcaption>2.2 腐蚀性质的探究</figcaption></figure><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Sobel 算子的腐蚀与膨胀<!--]--></span></span></button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->腐蚀性质的探究<!--]--></span></span></button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;01_luna.png&#39;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 读取图像</span></span>
<span class="line">gradient_x <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CV_32F<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">gradient_y <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CV_32F<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">gradient_xy <span class="token operator">=</span> cv2<span class="token punctuation">.</span>convertScaleAbs<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>magnitude<span class="token punctuation">(</span>gradient_x<span class="token punctuation">,</span> gradient_y<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>  <span class="token comment"># 创建一个3x3的矩形结构元素</span></span>
<span class="line">eroded <span class="token operator">=</span> cv2<span class="token punctuation">.</span>erode<span class="token punctuation">(</span>gradient_xy<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span></span>
<span class="line">dilated <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dilate<span class="token punctuation">(</span>gradient_xy<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>gradient_xy<span class="token punctuation">,</span> <span class="token string">&quot;Sobel XY uint8&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>eroded<span class="token punctuation">,</span> <span class="token string">&quot;Eroded&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>dilated<span class="token punctuation">,</span> <span class="token string">&quot;Dilated&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">img1 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line">img2 <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># img1 添加盐噪声（白点），img2 添加胡椒噪声（黑点）</span></span>
<span class="line">salt_coords <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">img1<span class="token punctuation">[</span>salt_coords<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> salt_coords<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span></span>
<span class="line">pepper_coords <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">img2<span class="token punctuation">[</span>pepper_coords<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pepper_coords<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line">kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>  <span class="token comment"># 创建一个3x3的矩形结构元素</span></span>
<span class="line">eroded1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>erode<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span></span>
<span class="line">eroded2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>erode<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">&#39;lightblue&#39;</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token string">&quot;Black Image&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>eroded1<span class="token punctuation">,</span> <span class="token string">&quot;Eroded&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> <span class="token string">&quot;White Image&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>eroded2<span class="token punctuation">,</span> <span class="token string">&quot;Eroded&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><h3 id="_2-2-形态学的刀与刀法" tabindex="-1"><a class="header-anchor" href="#_2-2-形态学的刀与刀法"><span>2.2 形态学的刀与刀法</span></a></h3><p>腐蚀与膨胀是形态学的基本操作，所以提供了函数接口 erode() 和 dilate()，用于执行单一的操作。<mark>getStructuringElement()</mark> 是 <strong>工具函数</strong>，用于创建形态学操作所需的“刷子”（结构元素）。<mark>morphologyEx()</mark> 是<strong>高级函数</strong>，它在内部调用基础函数，来实现更复杂的形态学操作。简单比喻：</p><ul><li>getStructuringElement() 像是 <strong>造一把刀</strong></li><li>erode() / dilate() 像是 <strong>切</strong> 或 <strong>削</strong> 的基本动作</li><li>morphologyEx() 像是 <strong>一套完整的雕刻技法</strong>（其中包含了切、削等基本动作）</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>shape<span class="token punctuation">,</span> ksize<span class="token punctuation">,</span> anchor<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ksize 通常为（3，3）/（5，5）/（7，7）。结构元素形状（shape）主要有 3 种：</p><ol><li><p><mark>MORPH_RECT：矩形（默认）</mark>。适合方向不敏感的块状、方形物体。比如<strong>车牌识别</strong>时候的字符和背景、<strong>文档处理</strong>时的文字笔画、矩形核能均匀的腐蚀/膨胀。在不确定形状时也用它，相对处理的均匀。</p></li><li><p><mark>MORPH_ELLIPSE：椭圆形</mark>。适合圆形、弧形、无尖锐棱角的物体。血液涂片或者生物样本中的<strong>细胞</strong>、工业检测中的<strong>气泡/液滴</strong>、人的<strong>虹膜</strong>识别、去除白色的圆形小噪声。</p></li><li><p><mark>MORPH_CROSS：十字形</mark>。适合线状、十字交叉状、需要保持对角线特征的物体。<strong>电路板检测</strong>（PCB 板上的导线是线状的）、<strong>指纹处理</strong>（指纹的脊线是曲线，十字核能更好地保持连通性）、<strong>字符细化</strong>（在 OCR 预处理中，十字核可以用于骨架提取而不破坏笔画连接）。</p></li></ol><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>src<span class="token punctuation">,</span> op<span class="token punctuation">,</span> kernel<span class="token punctuation">,</span> dst<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> anchor<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> iterations<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> borderType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>BORDER_CONSTANT<span class="token punctuation">,</span> borderValue<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>morphologyEx()</strong> 高级函数中的参数，几乎和 腐蚀/膨胀 一样。多出来的新参数 op 表示形态学的操作类型，比如：</p><ul><li>腐蚀为 <mark>cv2.MORPH_ERODE</mark>，与 erode() 相同</li><li>膨胀为 <mark>cv2.MORPH_DILATE</mark>，与 dilate() 相同</li><li>形态学梯度为 <mark>cv2.MORPH_GRADIENT</mark>，膨胀图 - 腐蚀图，约等于边缘检测</li></ul><p>这是我们已经接触过的三个操作。剩余的比如，开运算、闭运算、顶帽、黑帽、击中击不中（需二值图），且看后续。</p><h3 id="_2-3-开-闭运算" tabindex="-1"><a class="header-anchor" href="#_2-3-开-闭运算"><span>2.3 开/闭运算</span></a></h3><p><mark>开运算（Opening）</mark> 先执行腐蚀操作，然后使用相同的核进行膨胀。通过这种方式，可以利用腐蚀的特点，消除一些不需要的像素。通过第二步的膨胀，减少腐蚀对主体的影响。op 的名称是 <mark>cv2.MORPH_OPEN</mark>。</p><p>做一个简单的比方，在显微镜下，红细胞应该是独立的圆形细胞，但由于细胞密度大，很多细胞边缘刚好接触在一起，开运算可以断开这些细微的连接点，让计数更准确。</p><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/07_opening.png" alt="2.3 开运算 - 先腐蚀后膨胀" tabindex="0" loading="lazy"><figcaption>2.3 开运算 - 先腐蚀后膨胀</figcaption></figure><p>总结一下，开运算可以用在：<strong>去除 灰度或二值图 中的小噪点</strong>、<strong>分离“细小连接桥”，并保留主体形状</strong>。但是，如果是重叠度比较高的那种连接，它是去除不了的哦。</p><p><mark>闭运算（closing）</mark> 先执行膨胀操作，然后用同样的结构元素进行腐蚀。主要用于<strong>填充物体内部的细小空洞</strong>、<strong>连接邻近的物体</strong>、以及<strong>平滑物体的边界</strong>。op 的名称是 <mark>cv2.MORPH_CLOSE</mark>。</p><p>还是打个比方，在车牌识别中，由于光照或污渍，一个完整的数字或字符可能断裂成了几个部分。闭运算可以将这些距离很近的断点连接起来，使其成为一个完整的连通区域。</p><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/07_closing.png" alt="2.4 闭运算 - 先膨胀后腐蚀" tabindex="0" loading="lazy"><figcaption>2.4 闭运算 - 先膨胀后腐蚀</figcaption></figure><p>可以看到，矩形刷子明显对字母 A 的结构造成了比较大的破坏，椭圆刷子就好了很多。虽然这是因为刷子的面积过大造成的，但是如果真的有这么大的断裂呢？遇到不同的情况需要不同的应对。</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->闭运算代码<!--]--></span></span></button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->开运算代码<!--]--></span></span></button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建一个带有空洞的字母‘A’的图像</span></span>
<span class="line">image <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token string">&#39;A&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 故意在字母中间挖一个洞</span></span>
<span class="line">kernel1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_RECT<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 定义矩形核</span></span>
<span class="line">kernel2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_ELLIPSE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 定义椭圆核</span></span>
<span class="line">closing1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_CLOSE<span class="token punctuation">,</span> kernel1<span class="token punctuation">)</span></span>
<span class="line">closing2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_CLOSE<span class="token punctuation">,</span> kernel2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token string">&quot;The letter A with a hole&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>closing1<span class="token punctuation">,</span> <span class="token string">&quot;Closing OP by Rectangular&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>closing2<span class="token punctuation">,</span> <span class="token string">&quot;Closing OP by Ellipse&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生成一张有两个红细胞（圆形）+ 一条狭窄连接桥的二值图</span></span>
<span class="line">img <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 模拟“细胞粘连桥”</span></span>
<span class="line"></span>
<span class="line">kernel1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_ELLIPSE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">kernel2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_ELLIPSE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">opening1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_OPEN<span class="token punctuation">,</span> kernel1<span class="token punctuation">)</span></span>
<span class="line">opening2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_OPEN<span class="token punctuation">,</span> kernel2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># plt.figure(figsize=(14, 8), facecolor=&#39;lightblue&#39;)</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token string">&quot;Small Connecting Bridge&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>opening1<span class="token punctuation">,</span> <span class="token string">&quot;Opening OP by Ellipse 5x5&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>opening2<span class="token punctuation">,</span> <span class="token string">&quot;Opening OP by Ellipse 15x15&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><h3 id="_2-4-顶帽与低帽-黑帽" tabindex="-1"><a class="header-anchor" href="#_2-4-顶帽与低帽-黑帽"><span>2.4 顶帽与低帽（黑帽）</span></a></h3><p><mark>顶帽（Top-hat）</mark> 是用 <strong>原图 - 开运算图</strong>，提取 “比周围亮、尺寸比结构元小” 的区域，主要用于 <strong>去除非均匀背景、提取亮小物体</strong>。op 的名称为 <mark>cv2.MORPH_TOPHAT</mark>。</p><p><mark>黑帽（Black-hat）</mark> 是用 <strong>闭运算图 - 原图</strong>，提取 “比周围暗、尺寸比结构元小” 的区域，主要用于 <strong>突出暗斑、修正不均匀光照</strong>。op 的名称为 <mark>cv2.MORPH_BLACKHAT</mark>。</p><p>我们想一下，开运算，是把小的亮点去掉了，那么原图减去开运算图，它们的差其实就是被去掉的地方。黑帽也是同理，闭运算图是补全了小的暗洞，那么与原图的差就是小暗洞那一部分。</p><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/08_tophat.png" alt="2.5 顶帽运算：原图 - 开运算图" tabindex="0" loading="lazy"><figcaption>2.5 顶帽运算：原图 - 开运算图</figcaption></figure><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/08_blackhat.png" alt="2.6 黑帽运算：闭运算图 - 原图" tabindex="0" loading="lazy"><figcaption>2.6 黑帽运算：闭运算图 - 原图</figcaption></figure><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->顶帽运算代码<!--]--></span></span></button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M31 16l-7 7l-1.41-1.41L28.17 16l-5.58-5.59L24 9l7 7z" fill="currentColor"></path><path d="M1 16l7-7l1.41 1.41L3.83 16l5.58 5.59L8 23l-7-7z" fill="currentColor"></path><path d="M12.419 25.484L17.639 6l1.932.518L14.35 26z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->黑帽运算代码<!--]--></span></span></button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生成一张有两个红细胞（圆形）+ 一条狭窄连接桥的二值图</span></span>
<span class="line">img <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">210</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 模拟“细胞粘连桥”</span></span>
<span class="line"></span>
<span class="line">kernel2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_ELLIPSE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">opening2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_OPEN<span class="token punctuation">,</span> kernel2<span class="token punctuation">)</span></span>
<span class="line">tophat <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_TOPHAT<span class="token punctuation">,</span> kernel2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># plt.figure(figsize=(14, 8), facecolor=&#39;lightblue&#39;)</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token string">&quot;Small Connecting Bridge&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>opening2<span class="token punctuation">,</span> <span class="token string">&quot;Opening OP by Ellipse 15x15&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>tophat<span class="token punctuation">,</span> <span class="token string">&quot;Top-hat OP by Ellipse 15x15&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建一个带有空洞的字母‘A’的图像</span></span>
<span class="line">image <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token string">&#39;A&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 故意在字母中间挖一个洞</span></span>
<span class="line"></span>
<span class="line">kernel2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getStructuringElement<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_ELLIPSE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 定义椭圆核</span></span>
<span class="line">closing2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_CLOSE<span class="token punctuation">,</span> kernel2<span class="token punctuation">)</span></span>
<span class="line">blackhat <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_BLACKHAT<span class="token punctuation">,</span> kernel2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token string">&quot;The letter A with a hole&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>closing2<span class="token punctuation">,</span> <span class="token string">&quot;Closing OP by Ellipse 13x13&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>blackhat<span class="token punctuation">,</span> <span class="token string">&quot;Black-hat OP by Ellipse 13x13&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><h3 id="_2-5-击中-击不中变换" tabindex="-1"><a class="header-anchor" href="#_2-5-击中-击不中变换"><span>2.5 击中-击不中变换</span></a></h3><p><mark>击中-击不中变换（Hit-or-Miss Transform）</mark> 在经典的数学形态学中是一个核心但不常用（在深度学习出现以前比较重要）的操作，主要用于检测特定形状模式。在二值图像 A 中，给定一个结构元 B，击中-击不中变换定义为：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mo>⊛</mo><mi>B</mi><mo>=</mo><mo stretchy="false">(</mo><mi>A</mi><mo>⊝</mo><msub><mi>B</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msup><mi>A</mi><mi>c</mi></msup><mo>⊝</mo><msub><mi>B</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A\circledast{B}=(A\circleddash{B_{1}})(A^{c}\circleddash{B_{2}}) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7653em;vertical-align:-0.082em;"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin amsrm">⊛</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin amsrm">⊝</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin amsrm">⊝</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>B</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>B</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B=(B_{1},B_{2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">B_{1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 要求必须命中（hit）的前景位置，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>B</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">B_{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 要求必须不命中（miss）的背景位置。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mi>c</mi></msup></mrow><annotation encoding="application/x-tex">A^{c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span></span></span></span></span></span></span></span> 表示图像的补集（0 与 1 的翻转）。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊝</mo></mrow><annotation encoding="application/x-tex">\circleddash</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664em;vertical-align:-0.082em;"></span><span class="mord amsrm">⊝</span></span></span></span> 表示形态学腐蚀。最终输出是一个二值图，仅在 “完全匹配指定形状” 处为 1。</p><p>可以理解为早期的<strong>匹配模板</strong>，只有当 “图像局部形状” 完全符合结构元定义的 “前景+背景” 模式时，才算“击中”。做一个小实验，在 10x10 的黑色像素图像中，给两个白色的点，再给一个白色的线段，我们将结构元定义为像素点检测的形式，测试一下：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">show_img_by_plt</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> title<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> pos<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line">    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">&#39;off&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建测试图：孤立点 + 连续线</span></span>
<span class="line">img <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></span>
<span class="line">img<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">img<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">img<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义结构元：中心必须是 1，四周必须是 -1。执行击中-击不中变换</span></span>
<span class="line">kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                   <span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                   <span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>int8<span class="token punctuation">)</span></span>
<span class="line">hitmiss <span class="token operator">=</span> cv2<span class="token punctuation">.</span>morphologyEx<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>MORPH_HITMISS<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token string">&quot;Image with Point and Line 10x10&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>kernel<span class="token punctuation">,</span> <span class="token string">&quot;Hit-or-Miss Point Kernel 3x3&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">show_img_by_plt<span class="token punctuation">(</span>hitmiss<span class="token punctuation">,</span> <span class="token string">&quot;Hit-or-Miss Result 10x10&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/blog-vp-reco/cv/ImageProcessing/05_xxx/09_hitormiss.png" alt="2.7 击中-击不中变换" tabindex="0" loading="lazy"><figcaption>2.7 击中-击不中变换</figcaption></figure><p>可以看到，已经成功匹配到了两个孤立的白色像素，去掉了线段。这里有一个小坑需要注意，这个方法的图像，要求是 <strong>严格的二值图像</strong>，前景为 1 或者 255，背景为 0。</p><p>但是在结构元 kernel 中，取值却有三种语义。1 表示 hit，-1 表示 miss，而 0 表示不关心、无关的内容。所以，如果我们把 kernel 周围的值从 -1 变成 0，实际执行的只是 “前景命中检测”，没有背景约束。这样的话线段也会被匹配到，可以尝试一下：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                   <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                   <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>int8<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Git仓库提交时间 2025/10/14 13:37:28<!--]--></span></span></div></footer><nav class="page-nav"><p class="hasPrev hasNext inner"><span class="page-nav-item prev"> ← 04-锐化与均衡化</span><span class="page-nav-item next">06-阈值分割与边缘检测 → </span></p></nav><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_1-运算类操作" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. 运算类操作"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. 运算类操作<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_1-1-饱和运算" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.1 饱和运算"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.1 饱和运算<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_1-2-图像加减法" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.2 图像加减法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.2 图像加减法<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_1-3-图像混合" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.3 图像混合"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.3 图像混合<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_1-4-按位运算" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.4 按位运算"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.4 按位运算<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_2-形态学操作" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. 形态学操作"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. 形态学操作<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_2-1-膨胀与腐蚀" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.1 膨胀与腐蚀"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.1 膨胀与腐蚀<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_2-2-形态学的刀与刀法" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.2 形态学的刀与刀法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.2 形态学的刀与刀法<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_2-3-开-闭运算" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.3 开/闭运算"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.3 开/闭运算<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_2-4-顶帽与低帽-黑帽" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.4 顶帽与低帽（黑帽）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.4 顶帽与低帽（黑帽）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog-vp-reco/blogs/ComputerVision/ImageProcessing/OpenCV1/05_xingtaixueyuyunsuan.html#_2-5-击中-击不中变换" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.5 击中-击不中变换"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.5 击中-击不中变换<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/blog-vp-reco/assets/app-CkYqgEgS.js" defer></script>
  </body>
</html>
