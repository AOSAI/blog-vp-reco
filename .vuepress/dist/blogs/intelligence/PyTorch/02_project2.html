<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>实战1-参考答案 | AoSaiX</title><meta name="description" content="Blog for study, life and hobby.">
    <link rel="preload" href="/assets/style-qbxMTt3N.css" as="style"><link rel="stylesheet" href="/assets/style-qbxMTt3N.css">
    <link rel="modulepreload" href="/assets/app-Ccl-ihA3.js"><link rel="modulepreload" href="/assets/02_project2.html-eOJMYps9.js">
    <link rel="prefetch" href="/assets/timeline.html-5Y-KwsJw.js" as="script"><link rel="prefetch" href="/assets/posts.html-B2-IR5PK.js" as="script"><link rel="prefetch" href="/assets/friendship-link.html-CCYkFed9.js" as="script"><link rel="prefetch" href="/assets/1.html-BhCs3wNO.js" as="script"><link rel="prefetch" href="/assets/2.html-DNSgTpEw.js" as="script"><link rel="prefetch" href="/assets/3.html-GD9rCFjR.js" as="script"><link rel="prefetch" href="/assets/4.html-BDfUAAbL.js" as="script"><link rel="prefetch" href="/assets/index.html-2WY10xJF.js" as="script"><link rel="prefetch" href="/assets/01_compress_photo.html-Br1wZlYh.js" as="script"><link rel="prefetch" href="/assets/02_file_packaging.html-CR6GTlBl.js" as="script"><link rel="prefetch" href="/assets/03_pyqt5_recording.html-DElmxwq4.js" as="script"><link rel="prefetch" href="/assets/04_spider_for_ticket.html-CUqODpYs.js" as="script"><link rel="prefetch" href="/assets/index.html-BYcViRvD.js" as="script"><link rel="prefetch" href="/assets/index.html-iraMAcDx.js" as="script"><link rel="prefetch" href="/assets/index.html-7VfoPf1p.js" as="script"><link rel="prefetch" href="/assets/vuepress-recojiaocheng.html-DowmJsf4.js" as="script"><link rel="prefetch" href="/assets/01_fargoing.html-Bo6B5-uX.js" as="script"><link rel="prefetch" href="/assets/02_sichuan.html-CdhhCn3_.js" as="script"><link rel="prefetch" href="/assets/index.html-CqkWMqor.js" as="script"><link rel="prefetch" href="/assets/01.html-BT6hWype.js" as="script"><link rel="prefetch" href="/assets/index.html-DOtK9Apd.js" as="script"><link rel="prefetch" href="/assets/02_linear_regression.html-DlFutxoG.js" as="script"><link rel="prefetch" href="/assets/03_linear_regression.html-D5q399A8.js" as="script"><link rel="prefetch" href="/assets/04_classification.html-DhQIZj6S.js" as="script"><link rel="prefetch" href="/assets/05_deep_learning.html-Ca-twoW0.js" as="script"><link rel="prefetch" href="/assets/06_tensorflow.html-BFBLmMka.js" as="script"><link rel="prefetch" href="/assets/07_model_evaluation.html-kwVLdis8.js" as="script"><link rel="prefetch" href="/assets/08_decision_tree.html-TmQuwFNf.js" as="script"><link rel="prefetch" href="/assets/09_unsupervised_learning.html-CNL4hnqG.js" as="script"><link rel="prefetch" href="/assets/10_recommendation_system.html-CQu-CSjl.js" as="script"><link rel="prefetch" href="/assets/11_reinforcement_learning.html-DZ6-lqwW.js" as="script"><link rel="prefetch" href="/assets/index.html-B1FpnCA2.js" as="script"><link rel="prefetch" href="/assets/01.html-CKjkWbTN.js" as="script"><link rel="prefetch" href="/assets/index.html-BinKmnvX.js" as="script"><link rel="prefetch" href="/assets/01.html-DEufY0d9.js" as="script"><link rel="prefetch" href="/assets/index.html-BxL2_who.js" as="script"><link rel="prefetch" href="/assets/01_base.html-C7goX-xM.js" as="script"><link rel="prefetch" href="/assets/02_project1.html-B7ImDd4Y.js" as="script"><link rel="prefetch" href="/assets/03_project1.html-3tcJVBz6.js" as="script"><link rel="prefetch" href="/assets/index.html-Rt2v1rxY.js" as="script"><link rel="prefetch" href="/assets/01_recommend_model.html-DdbFxYrN.js" as="script"><link rel="prefetch" href="/assets/index.html-CHfv74pH.js" as="script"><link rel="prefetch" href="/assets/01_zongshu.html-Xtf7fNM0.js" as="script"><link rel="prefetch" href="/assets/02_xxx.html-ChAI_zDo.js" as="script"><link rel="prefetch" href="/assets/03_xxx.html--I9m-mId.js" as="script"><link rel="prefetch" href="/assets/01_zongshu.html-D2YG3EHx.js" as="script"><link rel="prefetch" href="/assets/02_jichucaozuo.html-C2vZOaYQ.js" as="script"><link rel="prefetch" href="/assets/03_zaoshengyulvbo.html-DsLDDmnh.js" as="script"><link rel="prefetch" href="/assets/04_xinhaoyutuxiang.html-CI8GZe0b.js" as="script"><link rel="prefetch" href="/assets/05_xingtaixueyutezheng.html-Chf59LtS.js" as="script"><link rel="prefetch" href="/assets/06_yasuoyubianma.html-CMm3cxtT.js" as="script"><link rel="prefetch" href="/assets/01_zongshu.html-BN1gvfyT.js" as="script"><link rel="prefetch" href="/assets/02_xxx.html-DToTaARp.js" as="script"><link rel="prefetch" href="/assets/03_xxx.html-BuYYFPRN.js" as="script"><link rel="prefetch" href="/assets/404.html-zEVeI1d1.js" as="script"><link rel="prefetch" href="/assets/Valine.min-_LyT3bfY.js" as="script"><link rel="prefetch" href="/assets/giscus-aTimukGI-DWEKOTfS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container show-series show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/logo1.svg" alt="AoSaiX"><a href="/" class="site-name can-hide">AoSaiX</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="旧博客迁移(未整理)"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->旧博客迁移(未整理)<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="旧博客迁移(未整理)"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->旧博客迁移(未整理)<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/blogs/desktop_app/README.md" class="link" aria-label="桌面软件开发"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->桌面软件开发<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blogs/intelligence/MachineLearning/readme" class="link" aria-label="机器学习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->机器学习<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blogs/intelligence/Matplotlib/readme" class="link" aria-label="Matplotlib"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Matplotlib<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blogs/intelligence/Numpy/readme" class="link" aria-label="Numpy"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Numpy<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blogs/intelligence/PyTorch/readme" class="link" aria-label="PyTorch"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->PyTorch<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blogs/intelligence/recommendationSystem/readme" class="link" aria-label="推荐系统"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->推荐系统<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blogs/dobetter/mahjong/README" class="link" aria-label="雀神之路"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->雀神之路<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/blogs/dobetter/musictheroy/README" class="link" aria-label="音乐之旅"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->音乐之旅<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="计算机视觉"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->计算机视觉<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="计算机视觉"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->计算机视觉<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/series/ComputerVision/ImageProcessing/01_综述" class="link" aria-label="图像处理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->图像处理<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/ComputerVision/ImageGeneration/01_综述" class="link" aria-label="生图模型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->生图模型<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/series/ComputerVision/TargetDetection/01_综述" class="link" aria-label="目标检测"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->目标检测<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="学思随录"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->学思随录<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="学思随录"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->学思随录<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/docs/2025/vuepress-reco教程" class="link" aria-label="2025年"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025年<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="星河驿站"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->星河驿站<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="星河驿站"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->星河驿站<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#" class="router-link-active router-link-exact-active link" aria-label="烟火人间"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->烟火人间<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#" class="router-link-active router-link-exact-active link" aria-label="逐趣成章"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->逐趣成章<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><header class="sub-navbar-container not-open"><span class="nav-item"><div class="toggle-series-button" aria-expanded="false" role="button" tabindex="0"><span></span><span></span><span></span></div> Series </span></header><!----><!----><div class="theme-main" style=""><aside class="series-container"><!--[--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->桌面软件开发<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blogs/desktop_app/" class="link series-item series-item" aria-label="桌面级应用开发相关"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->桌面级应用开发相关<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/desktop_app/01_compress_photo.html" class="link series-item series-item" aria-label="Python桌面压缩图片小工具"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Python桌面压缩图片小工具<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/desktop_app/02_file_packaging.html" class="link series-item series-item" aria-label="Python文件打包exe方法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Python文件打包exe方法<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/desktop_app/03_pyqt5_recording.html" class="link series-item series-item" aria-label="PyQt5使用及踩坑小记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->PyQt5使用及踩坑小记<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/desktop_app/04_spider_for_ticket.html" class="link series-item series-item" aria-label="Python网络爬虫-爬取12306余票信息"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Python网络爬虫-爬取12306余票信息<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->机器学习<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blogs/intelligence/MachineLearning/" class="link series-item series-item" aria-label="0-0 机器学习目录与概述"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->0-0 机器学习目录与概述<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/MachineLearning/02_linear_regression.html" class="link series-item series-item" aria-label="1-1 一元线性回归"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1-1 一元线性回归<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/MachineLearning/03_linear_regression.html" class="link series-item series-item" aria-label="1-2 多元线性回归"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1-2 多元线性回归<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/MachineLearning/04_classification.html" class="link series-item series-item" aria-label="1-3 分类问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1-3 分类问题<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/MachineLearning/05_deep_learning.html" class="link series-item series-item" aria-label="2-1 神经网络初探"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2-1 神经网络初探<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/MachineLearning/06_tensorflow.html" class="link series-item series-item" aria-label="2-2 神经网络进阶"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2-2 神经网络进阶<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/MachineLearning/07_model_evaluation.html" class="link series-item series-item" aria-label="2-3 模型评估"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2-3 模型评估<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/MachineLearning/08_decision_tree.html" class="link series-item series-item" aria-label="2-4 决策树模型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2-4 决策树模型<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/MachineLearning/09_unsupervised_learning.html" class="link series-item series-item" aria-label="3-1 无监督学习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3-1 无监督学习<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/MachineLearning/10_recommendation_system.html" class="link series-item series-item" aria-label="3-2 推荐系统"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3-2 推荐系统<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/MachineLearning/11_reinforcement_learning.html" class="link series-item series-item" aria-label="3-3 强化学习"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3-3 强化学习<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->Matplotlib<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blogs/intelligence/Matplotlib/" class="link series-item series-item" aria-label="画布结构详解"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->画布结构详解<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/Matplotlib/01.html" class="link series-item series-item" aria-label="常见图及属性"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常见图及属性<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->Numpy<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blogs/intelligence/Numpy/" class="link series-item series-item" aria-label="Numpy之拜入宗门"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Numpy之拜入宗门<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/Numpy/01.html" class="link series-item series-item" aria-label="Numpy之熬炼筋骨"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Numpy之熬炼筋骨<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1 active"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->PyTorch<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blogs/intelligence/PyTorch/" class="link series-item series-item" aria-label="PyTorch入门手册"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->PyTorch入门手册<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/PyTorch/01_base.html" class="link series-item series-item" aria-label="PyTorch基础知识"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->PyTorch基础知识<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/PyTorch/02_project1.html" class="link series-item series-item" aria-label="实战1-离散分类问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->实战1-离散分类问题<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html" class="router-link-active router-link-exact-active link router-link-active series-item series-item" aria-label="实战1-参考答案"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->实战1-参考答案<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/PyTorch/03_project1.html" class="link series-item series-item" aria-label="实战2-线性拟合问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->实战2-线性拟合问题<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->推荐系统<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blogs/intelligence/recommendationSystem/" class="link series-item series-item" aria-label="推荐系统基础 - 01"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->推荐系统基础 - 01<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/intelligence/recommendationSystem/01_recommend_model.html" class="link series-item series-item" aria-label="推荐系统基础 - 02"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->推荐系统基础 - 02<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->雀神之路<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blogs/dobetter/mahjong/" class="link series-item series-item" aria-label="麻将大全"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->麻将大全<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/dobetter/mahjong/01_fargoing.html" class="link series-item series-item" aria-label="麻将通识"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->麻将通识<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/dobetter/mahjong/02_sichuan.html" class="link series-item series-item" aria-label="四川麻将"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->四川麻将<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->音乐之旅<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><a href="/blogs/dobetter/musictheroy/" class="link series-item series-item" aria-label="音乐理论中的科学"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->音乐理论中的科学<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/blogs/dobetter/musictheroy/01.html" class="link series-item series-item" aria-label="吉他的乐理基础"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->吉他的乐理基础<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--]--></aside><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">实战1-参考答案</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->AOSAI<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025-03-03<!--]--></span></span><!----><!----><!----></div><div class="theme-reco-md-content"><div><h2 id="_1-二分类问题-其一" tabindex="-1"><a class="header-anchor" href="#_1-二分类问题-其一"><span>1. 二分类问题 - 其一</span></a></h2><p>UCI Machine Learning Repository 是一个著名的公开数据集仓库，由加州大学欧文分校（University of California, Irvine）维护。它收集了大量用于机器学习研究和教学的数据集，涵盖了分类、回归、聚类、推荐系统等多种任务。</p><p>它对数据集的介绍十分的详细，以肿瘤预测数据集为例，先是六个标签，说明了这个数据集是针对医疗健康领域的分类问题，全部特征都是真实的，有 569 个实例，30 个特征。接着是对数据集的一个简要介绍，最下方是这个数据集最初出现的论文链接。右边栏是数据集下载和引用的按钮，以及一些其他信息。</p><p>P.S. 为什么说的这么详细，是因为我最初看到这些全是英文的东西，非常的抗拒，总觉得很难，没有一点看下去的欲望，而网页的全文翻译有的时候，并不是那么准确，有可能导致理解起来更为困难。所以，嗯，为了鼓励曾经的我自己，以及像曾经的我一样，难以坚持的小伙伴。</p><figure><img src="/pytorch/02_classification/02-01.png" alt="2.1 公开数据集仓库 - UCI - 1" width="560" tabindex="0" loading="lazy"><figcaption>2.1 公开数据集仓库 - UCI - 1</figcaption></figure><p>UCI 仓库对数据集的所有特征列了一个表格，并且对于一些特别需要说明的特征，在下方（Additional Variable Information）中进行了解释。方便我们理解，更好的进行特征工程。</p><p>并且它还很贴心的贴出了目前最常被使用的 5 中机器学习算法，对比了它们在数据集上的准确度。可以看出，1 和 3（都是决策树模型）是最佳的解决方案，第 2 个 SVM 的效果甚至不如第 5 个逻辑回归，神经网络的准确度是最差的。</p><div class="layout"><figure><img src="/pytorch/02_classification/02-02.png" alt="2.2 公开数据集仓库 - UCI - 2" width="360" tabindex="0" loading="lazy"><figcaption>2.2 公开数据集仓库 - UCI - 2</figcaption></figure><figure><img src="/pytorch/02_classification/02-03.png" alt="2.3 公开数据集仓库 - UCI - 3" width="360" tabindex="0" loading="lazy"><figcaption>2.3 公开数据集仓库 - UCI - 3</figcaption></figure></div><h3 id="_1-1-数据格式" tabindex="-1"><a class="header-anchor" href="#_1-1-数据格式"><span>1.1 数据格式</span></a></h3><p>UCI 数据集通常以文本文件（如 .data、.csv 或 .txt）的形式提供，文件内容可能是纯文本或逗号分隔的表格数据。下载解压完肿瘤分类的数据集，有两个文件 wdbc.data 和 wdbc.names，VS Code 可以直接打开。后者通常包含数据集的详细描述和元数据。这个文件的作用是帮助用户理解数据集的结构、特征的含义以及如何使用数据。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># .csv（Comma-Separated Values）</span></span>
<span class="line"><span class="token comment"># 以逗号分隔的表格数据，每行是一个样本，每列是一个特征。通常第一行是特征的名称（列名）。</span></span>
<span class="line">feature1<span class="token punctuation">,</span>feature2<span class="token punctuation">,</span>feature3<span class="token punctuation">,</span>label</span>
<span class="line"><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">3.7</span><span class="token punctuation">,</span><span class="token number">0</span></span>
<span class="line"><span class="token number">2.1</span><span class="token punctuation">,</span><span class="token number">3.4</span><span class="token punctuation">,</span><span class="token number">4.8</span><span class="token punctuation">,</span><span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># .data</span></span>
<span class="line"><span class="token comment"># 通常是以空格、制表符或逗号分隔的纯文本文件，格式可能与 CSV 类似。没有特征的名称。</span></span>
<span class="line"><span class="token number">1.0</span> <span class="token number">2.5</span> <span class="token number">3.7</span> <span class="token number">0</span></span>
<span class="line"><span class="token number">2.1</span> <span class="token number">3.4</span> <span class="token number">4.8</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># .txt</span></span>
<span class="line"><span class="token comment"># 纯文本文件，格式可能与 .data 类似，也可能是其他自定义格式。</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>.csv 和 .data 文件格式一般都用 Pandas 读取，.txt 文本文件根据内容选择合适的方法（如 pandas.read_csv() 或 numpy.loadtxt()）。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"></span>
<span class="line"><span class="token comment"># .csv</span></span>
<span class="line"><span class="token comment"># header 属性有三种参数，None 表示没有列名（特征的名称）</span></span>
<span class="line"><span class="token comment"># 单个数字表示指定哪一行作为列名，比如0表示第一行，3表示第四行，[0, 1]表示前两行都是列名</span></span>
<span class="line"><span class="token comment"># ‘infer’ 与 header=0 相同，自动推断第一行为列名</span></span>
<span class="line">data1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;xxxx.csv&quot;</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># .data</span></span>
<span class="line"><span class="token comment"># 根据分割数据的方式，指定分隔符：‘，’逗号分隔，‘ ’空格分隔，‘\t’制表符分隔</span></span>
<span class="line">data2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;xxxx.data&quot;</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">&#39;,&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># .txt</span></span>
<span class="line"><span class="token comment"># pandas的读取方式和 .data 一致，这里仅写 numpy 函数，该函数没有 header 属性。</span></span>
<span class="line"><span class="token comment"># delimiter 的使用方法和 pd 一致。但它是一个更底层的函数，适合读取纯数值数据。</span></span>
<span class="line">data3 <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">&#39;xxxx.txt&#39;</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2-肿瘤分类" tabindex="-1"><a class="header-anchor" href="#_1-2-肿瘤分类"><span>1.2 肿瘤分类</span></a></h3><p>表格中写明了（.name 文件中也写的很清楚），第一个参数（第一列）是 ID number，第二个参数（第二列）是标签，M = malignant 表示恶性肿瘤，转换为数字 1，B = benign 表示良性肿瘤，转换为数字 0。.data 文件中的后三十列的参数才是特征，我们可以进行训练前的数据处理了。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder<span class="token punctuation">,</span> StandardScaler</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split</span>
<span class="line"></span>
<span class="line"><span class="token comment"># load data</span></span>
<span class="line">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;./bcwd/wdbc.data&quot;</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># extract labels and features</span></span>
<span class="line">X <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line">y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line"></span>
<span class="line"><span class="token comment"># transform labels to numbers（M -&gt; 1, B -&gt; 0）</span></span>
<span class="line">label_encoder <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">y <span class="token operator">=</span> label_encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># normalize features</span></span>
<span class="line">scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">X_scaled <span class="token operator">=</span> scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># split training set and testing set</span></span>
<span class="line">X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span></span>
<span class="line">    X_scaled<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># check the results</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;训练集特征形状:&quot;</span><span class="token punctuation">,</span> X_train<span class="token punctuation">.</span>shape<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;测试集特征形状:&quot;</span><span class="token punctuation">,</span> X_test<span class="token punctuation">.</span>shape<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>fit_transform() 是一个很有意思的函数。fit 用于拟合数据，transform 用于转换数据，应用拟合后的规则，fit_transform 是将两者结合起来，一次行完整拟合和转换。像上方代码中的标签数字化和数据标准化，如果分开写是这样的：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">label_encoder <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 初始化 标签数值转换器</span></span>
<span class="line">label_encoder<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>y<span class="token punctuation">)</span>            <span class="token comment"># 拟合规则，按照字母顺序排序，b在前为0，m在后为1</span></span>
<span class="line">y <span class="token operator">=</span> label_encoder<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>y<span class="token punctuation">)</span>  <span class="token comment"># 转化数据</span></span>
<span class="line"></span>
<span class="line">scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment"># 初始化 标准化函数</span></span>
<span class="line">scaler<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">)</span>                   <span class="token comment"># 拟合数据，计算均值和标准差</span></span>
<span class="line">X_scaled <span class="token operator">=</span> scaler<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X<span class="token punctuation">)</span>  <span class="token comment"># 转换数据</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来就是使用模型，进行计算和评估了。我们使用 UCI 统计过的，最佳的两种决策树模型，随机森林 和 xgboost：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score<span class="token punctuation">,</span> confusion_matrix<span class="token punctuation">,</span> classification_report</span>
<span class="line"><span class="token comment"># from xgboost import XGBClassifier</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化随机森林模型，XGBoost 模型</span></span>
<span class="line">model1 <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># model2 = XGBClassifier(n_estimators=100, random_state=42)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 随机森林 训练、预测、评估</span></span>
<span class="line">model1<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line">y_pred1 <span class="token operator">=</span> model1<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line">accuracy1 <span class="token operator">=</span> accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred1<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;random forest 模型准确率：&quot;</span><span class="token punctuation">,</span> accuracy1<span class="token punctuation">)</span></span>
<span class="line">conf_matrix1 <span class="token operator">=</span> confusion_matrix<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred1<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;random forest 的混淆矩阵：\n&quot;</span><span class="token punctuation">,</span> conf_matrix1<span class="token punctuation">)</span></span>
<span class="line">class_report1 <span class="token operator">=</span> classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred1<span class="token punctuation">,</span> target_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;良性 (B)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;恶性 (M)&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;random forest 的分类报告：\n&quot;</span><span class="token punctuation">,</span> class_report1<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>96.5%的准确率，其实还不错。但是我们观察 UCI 中的模型性能表现，gxboost 的准确率均值在 97.2，而随机森林高达 97.9，它是怎么做到的呢？</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">random forest 模型准确率： <span class="token number">0.9649122807017544</span></span>
<span class="line">random forest 的混淆矩阵：</span>
<span class="line"> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">70</span>  <span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line"> <span class="token punctuation">[</span> <span class="token number">3</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">]</span></span>
<span class="line">random forest 的分类报告：</span>
<span class="line">               precision    recall  f1<span class="token operator">-</span>score   support</span>
<span class="line"></span>
<span class="line">      良性 <span class="token punctuation">(</span>B<span class="token punctuation">)</span>       <span class="token number">0.96</span>      <span class="token number">0.99</span>      <span class="token number">0.97</span>        <span class="token number">71</span></span>
<span class="line">      恶性 <span class="token punctuation">(</span>M<span class="token punctuation">)</span>       <span class="token number">0.98</span>      <span class="token number">0.93</span>      <span class="token number">0.95</span>        <span class="token number">43</span></span>
<span class="line"></span>
<span class="line">    accuracy                           <span class="token number">0.96</span>       <span class="token number">114</span></span>
<span class="line">   macro avg       <span class="token number">0.97</span>      <span class="token number">0.96</span>      <span class="token number">0.96</span>       <span class="token number">114</span></span>
<span class="line">weighted avg       <span class="token number">0.97</span>      <span class="token number">0.96</span>      <span class="token number">0.96</span>       <span class="token number">114</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3-决策树优化" tabindex="-1"><a class="header-anchor" href="#_1-3-决策树优化"><span>1.3 决策树优化</span></a></h3><p>想要提高随机森林的准确率，可以从以下几个方面入手：</p><ol><li>调整超参数：使用网格搜索找到最佳参数组合</li><li>特征工程：选择重要特征，或构造新特征</li><li>数据增强：处理类别不平衡问题</li><li>集成学习：结合多个模型提高性能</li></ol><p>（1）随机森林中的超参数</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义网格参数，参数需要自己慢慢微调</span></span>
<span class="line">param_grid1 <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment"># 树的数量</span></span>
<span class="line">    <span class="token string">&#39;n_estimators&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment"># 树的最大深度。控制每棵树的复杂度，设置太小会欠拟合，太大会过拟合</span></span>
<span class="line">    <span class="token string">&#39;max_depth&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment"># 节点分裂的最小样本数。较大的值可以防止过拟合。</span></span>
<span class="line">    <span class="token string">&#39;min_samples_split&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment"># 叶子节点的最小样本数。较大的值可以防止过拟合。</span></span>
<span class="line">    <span class="token string">&#39;min_samples_leaf&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment"># 每次分裂时考虑的最大特征数量。较小的值可以防止过拟合。</span></span>
<span class="line">    <span class="token string">&#39;max_features&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;sqrt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;log2&#39;</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化随机森林模型</span></span>
<span class="line">model1 <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化网格搜索, 执行网格搜索</span></span>
<span class="line">grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>estimator<span class="token operator">=</span>model1<span class="token punctuation">,</span> param_grid<span class="token operator">=</span>param_grid1<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">&#39;accuracy&#39;</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 输出最佳参数和准确率</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最佳参数:&quot;</span><span class="token punctuation">,</span> grid_search<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最佳准确率:&quot;</span><span class="token punctuation">,</span> grid_search<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 结果：96.7%，比原先提高了约 0.2%，还不错</span></span>
<span class="line">最佳参数<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;max_depth&#39;</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">&#39;max_features&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;log2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;min_samples_leaf&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;min_samples_split&#39;</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&#39;n_estimators&#39;</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">}</span></span>
<span class="line">最佳准确率<span class="token punctuation">:</span> <span class="token number">0.9670329670329669</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）特征工程（特征选择、特征构造）</p><p>特征构造需要对这些特征的含义有一定的理解，比如：肿瘤半径和周长之间可以有比值、肿瘤面积和纹理之间可以有乘积等等。这些需要一定的专业领域知识和经验。</p><p>所以此处就记录两种特征选择的方法：SelectFromModel 和 RFE。SelectFromModel 的结果反而比原始方法的准确率还要低一些，RFE 方法的准确率和原始方法持平。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_selection <span class="token keyword">import</span> SelectFromModel</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_selection <span class="token keyword">import</span> RFE</span>
<span class="line"></span>
<span class="line">model <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># # 选择重要性高于平均值、中值的特征</span></span>
<span class="line"><span class="token comment"># selector = SelectFromModel(model, threshold=&#39;mean&#39;)</span></span>
<span class="line"><span class="token comment"># selector = SelectFromModel(model, threshold=&#39;median&#39;)</span></span>
<span class="line"><span class="token comment"># X_train_selected = selector.fit_transform(X_train, y_train)</span></span>
<span class="line"><span class="token comment"># X_test_selected = selector.transform(X_test)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用 RFE 递归的剔除一些不重要的特征</span></span>
<span class="line">selector <span class="token operator">=</span> RFE<span class="token punctuation">(</span>model<span class="token punctuation">,</span> n_features_to_select<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>  <span class="token comment"># 选择 15 个特征</span></span>
<span class="line">X_train_selected <span class="token operator">=</span> selector<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line">X_test_selected <span class="token operator">=</span> selector<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 重新训练模型</span></span>
<span class="line">model_selected <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">model_selected<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_selected<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 评估模型</span></span>
<span class="line">y_pred_selected <span class="token operator">=</span> model_selected<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_selected<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;筛选特征后的准确率:&quot;</span><span class="token punctuation">,</span> accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_selected<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）数据增强（SMOTE）</p><p>类别不平衡问题是指，在分类问题中，如果某一类的样本数量远少于其他类，模型可能会偏向多数类，导致少数类的分类性能较差。</p><p>对于少数类中的每个样本，SMOTE 会找到它的 k 个最近邻（默认值是 5 个）。然后，随机选择一个最近邻，并在两者之间的连线上生成一个新的合成样本。新样本的特征值是原始样本和最近邻样本的线性组合。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> imblearn<span class="token punctuation">.</span>over_sampling <span class="token keyword">import</span> SMOTE</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化 SMOTE</span></span>
<span class="line">smote <span class="token operator">=</span> SMOTE<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生成增强数据</span></span>
<span class="line">X_train_resampled<span class="token punctuation">,</span> y_train_resampled <span class="token operator">=</span> smote<span class="token punctuation">.</span>fit_resample<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 重新训练模型</span></span>
<span class="line">model_resampled <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">model_resampled<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_resampled<span class="token punctuation">,</span> y_train_resampled<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 评估模型</span></span>
<span class="line">y_pred_resampled <span class="token operator">=</span> model_resampled<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;数据增强后的准确率:&quot;</span><span class="token punctuation">,</span> accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_resampled<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 结果：97.4%，比原始模型提高了 0.9%</span></span>
<span class="line">数据增强后的准确率<span class="token punctuation">:</span> <span class="token number">0.9736842105263158</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出，在数据集相对较小，且类别分别不均衡的情况下，数据增强的效果非常好。我们尝试进一步优化 SMOTE 的参数，将其 k-近邻 的值调整后对比准确度：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 我发现当 k_neighbors 为 4 或 6 的时候，效果最佳。</span></span>
<span class="line">smote <span class="token operator">=</span> SMOTE<span class="token punctuation">(</span>k_neighbors<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 结果：98.3%，比原始模型提高了 1.8%，已经超过了 UCI 中随机森林的均值准确度</span></span>
<span class="line">数据增强后的准确率<span class="token punctuation">:</span> <span class="token number">0.9824561403508771</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（4）集成学习</p><p>因为在数据增强那块，我已经让结果达到了我的预期，所以我并没有在集成学习这里尝试很多种方式，仅仅使用了投票表决（Voting）模型作为一个测试。<mark>如果有兴趣，可以尝试将不同的优化方式组合起来，也许准确度能到 100%呢？</mark></p><p>将多个模型结合在一起的方式也有很多种：</p><ul><li>Voting 是结合多个模型的预测结果，通过投票决定最终预测。</li><li>Stacking 是将多个模型的预测结果作为新特征，训练一个元模型。</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> VotingClassifier</span>
<span class="line"><span class="token keyword">from</span> xgboost <span class="token keyword">import</span> XGBClassifier</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化多个模型</span></span>
<span class="line">model_rf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">model_xgb <span class="token operator">=</span> XGBClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 初始化 VotingClassifier</span></span>
<span class="line">voting_model <span class="token operator">=</span> VotingClassifier<span class="token punctuation">(</span>estimators<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token string">&#39;rf&#39;</span><span class="token punctuation">,</span> model_rf<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">(</span><span class="token string">&#39;xgb&#39;</span><span class="token punctuation">,</span> model_xgb<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">,</span> voting<span class="token operator">=</span><span class="token string">&#39;soft&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 训练集成模型</span></span>
<span class="line">voting_model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 评估模型</span></span>
<span class="line">y_pred_voting <span class="token operator">=</span> voting_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;集成模型的准确率:&quot;</span><span class="token punctuation">,</span> accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred_voting<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-二分类问题-其二" tabindex="-1"><a class="header-anchor" href="#_2-二分类问题-其二"><span>2. 二分类问题 - 其二</span></a></h2><p>《泰坦尼克号幸存者预测》项目是 Kaggle 平台上的一个竞赛挑战，以该项目为例，记录一下我们打开项目页面后需要注意的内容。每个竞赛项目打开后，名称下方都有一行标签页：</p><ul><li>Overview：项目概况介绍，也说明了提交项目结果的流程和方法</li><li>Data：数据集的介绍，以及下载链接</li><li>Code：别人分享的代码，虽然说是代码，我看了一下有很多都是把解题思路写的很详细的</li><li>Models：可能是不同类别的模型解题的记录（大概如此）</li><li>Discussion：讨论平台</li><li>Leaderboard：提交后评分的排名（现在基本都是 100%的正确率）</li><li>Rules：规则说明（比如下载一个项目的数据集后，默认你接受了这个竞赛挑战，未提交答案的情况下，是不允许你下载其它项目的数据集的）</li></ul><figure><img src="/pytorch/02_classification/02-04.png" alt="2.4 Kaggle平台 - 泰坦尼克号幸存者分类" width="560" tabindex="0" loading="lazy"><figcaption>2.4 Kaggle平台 - 泰坦尼克号幸存者分类</figcaption></figure><p>一般来说，我们只用看 Overview 和 data 两个部分，前者是为了让我们了解，项目想让我们做什么（目标），后者是为了获取数据集，以及让我们快速了解特征的构成。</p><p>当然了，如果找不到解题思路，可以借鉴一下别人的思路和代码，从模仿中学；独立做出来了，有兴趣的话也可以去代码区或者讨论区，学习别人的经验，或者帮别人解惑，讨论一些内容。</p><p>如图所示，该项目的数据集有三个文件，一个训练集，一个测试集，还有一个提交 csv 的模版文件。</p><h3 id="_2-1-pandas-数据检查方法" tabindex="-1"><a class="header-anchor" href="#_2-1-pandas-数据检查方法"><span>2.1 Pandas 数据检查方法</span></a></h3><p>不论是机器学习的算法（线性回归、SVM、决策树等），还是神经网络的算法，都依赖数学计算，如距离计算、矩阵计算等等，这都计算都需要数值的输入。<mark>数值数据是算法处理的通用格式，无论是分类、回归还是聚类任务。</mark></p><p>在我大致扫了一眼的情况下，发现有很多特征都是字符串形式的，比如名字（Name），船票编号（Ticket），登船港口（Embarked）等，船舱号（cabin）甚至还有缺失值（没有数据）出现。所以，首先先查看一下数据集的基本信息：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"></span>
<span class="line">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;titanic/train.csv&quot;</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 结果显示</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">&#39;pandas.core.frame.DataFrame&#39;</span><span class="token operator">&gt;</span></span>
<span class="line">RangeIndex<span class="token punctuation">:</span> <span class="token number">891</span> entries<span class="token punctuation">,</span> <span class="token number">0</span> to <span class="token number">890</span></span>
<span class="line">Data columns <span class="token punctuation">(</span>total <span class="token number">12</span> columns<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line"> <span class="token comment">#   Column       Non-Null Count  Dtype</span></span>
<span class="line"><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>       <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span></span>
<span class="line"> <span class="token number">0</span>   PassengerId  <span class="token number">891</span> non<span class="token operator">-</span>null    int64</span>
<span class="line"> <span class="token number">1</span>   Survived     <span class="token number">891</span> non<span class="token operator">-</span>null    int64</span>
<span class="line"> <span class="token number">2</span>   Pclass       <span class="token number">891</span> non<span class="token operator">-</span>null    int64</span>
<span class="line"> <span class="token number">3</span>   Name         <span class="token number">891</span> non<span class="token operator">-</span>null    <span class="token builtin">object</span></span>
<span class="line"> <span class="token number">4</span>   Sex          <span class="token number">891</span> non<span class="token operator">-</span>null    <span class="token builtin">object</span></span>
<span class="line"> <span class="token number">5</span>   Age          <span class="token number">714</span> non<span class="token operator">-</span>null    float64</span>
<span class="line"> <span class="token number">6</span>   SibSp        <span class="token number">891</span> non<span class="token operator">-</span>null    int64</span>
<span class="line"> <span class="token number">7</span>   Parch        <span class="token number">891</span> non<span class="token operator">-</span>null    int64</span>
<span class="line"> <span class="token number">8</span>   Ticket       <span class="token number">891</span> non<span class="token operator">-</span>null    <span class="token builtin">object</span></span>
<span class="line"> <span class="token number">9</span>   Fare         <span class="token number">891</span> non<span class="token operator">-</span>null    float64</span>
<span class="line"> <span class="token number">10</span>  Cabin        <span class="token number">204</span> non<span class="token operator">-</span>null    <span class="token builtin">object</span></span>
<span class="line"> <span class="token number">11</span>  Embarked     <span class="token number">889</span> non<span class="token operator">-</span>null    <span class="token builtin">object</span></span>
<span class="line">dtypes<span class="token punctuation">:</span> float64<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> int64<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">memory usage<span class="token punctuation">:</span> <span class="token number">83.7</span><span class="token operator">+</span> KB</span>
<span class="line"><span class="token boolean">None</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过 info() 的基本信息显示，我们发现有 5 种特征的数据类型是不对的，要从 object 转换成数值类型。另外，年龄（Age），船舱号（Cabin），登船港口（Embarked）这三种特征的数量不是 891 满的状态，说明它们都有缺失值（NaN）出现。通常遇到缺值的情况，我们会有几种常见的处理方式：</p><ol><li>如果缺值的样本占总数比例极高，我们可能就直接舍弃了，作为特征加入的话，可能反倒带入 noise，影响最后的结果了</li><li>如果缺值的样本比例适中，而该属性非连续值特征属性(比如说类目属性)，那就把 NaN 作为一个新类别，加到类别特征中</li><li>如果缺值的样本比例适中，而该属性为连续值特征属性，有时候我们会考虑给定一个 step 线性拟合填补空缺，或者根据已有的值填补。</li></ol><p>知道了问题所在，就要开始解决问题了：</p><ul><li><p>名字（Name）处理起来比较复杂，先删了试试，万一这个特征对预测没有帮助呢</p></li><li><p>性别（Sex）只有两个值，可以使用 LabelEncoder 或 OneHotEncoder 转换为数值</p></li><li><p>年龄（Age）本身就是数值类型，通过 describe() 函数查看一下统计信息，没有数字敏感度的人可以选择将统计信息可视化。这里就用年龄的平均值填充一下空缺</p></li><li><p>船票（Ticket）属于混合格式的数据，处理起来也比较复杂，先删了</p></li><li><p>船舱号（Cabin）缺失值占比太高，删除</p></li><li><p>登船港口（Embarked）是单独的一个字母代表不同的港口，只有三个港口（S，C，Q），最多的港口为 S，占比很大，缺失值就只有 2 个，就拿 ‘S’ 填充好了，然后用 LabelEncoder 转换即可</p></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder</span>
<span class="line"></span>
<span class="line">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;titanic/train.csv&quot;</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># drop 是 Pandas 中的函数，用于删除行或列。参数 1：列名；参数 axis：1表示列，0表示行；</span></span>
<span class="line"><span class="token comment"># 参数 inplace：是否直接在原数据（对象 data）上修改，True直接修改</span></span>
<span class="line"><span class="token comment"># False 会返回一个新数据集，需要赋值给一个新对象，比如 data_new = xxx</span></span>
<span class="line">data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">&#39;Name&#39;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">&#39;Ticket&#39;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">&#39;Cabin&#39;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 数值转换：性别（Sex），船舱号（Cabin），登船港口（Embarked）</span></span>
<span class="line"><span class="token comment"># 缺失值填补：年龄（Age），船舱号（Cabin），登船港口（Embarked）</span></span>
<span class="line"><span class="token comment"># fillna 函数是 Pandas 中用于处理缺失值的方法，将缺失值 NaN 替换为自定义的值</span></span>
<span class="line">data<span class="token punctuation">[</span><span class="token string">&#39;Sex&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;Sex&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;male&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;female&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">data<span class="token punctuation">[</span><span class="token string">&#39;Age&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;Age&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;Age&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">data<span class="token punctuation">[</span><span class="token string">&#39;Embarked&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;Embarked&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">&quot;S&quot;</span><span class="token punctuation">)</span></span>
<span class="line">data<span class="token punctuation">[</span><span class="token string">&#39;Embarked&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;Embarked&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>经过这一波操作，我们可以知道 Pandas 的数据检查方法，对我们训练的前的数据处理非常有帮助，因此做一个整理记录：</p><ol><li><p>数据查看方法</p><ul><li>data.head(4): 查看表格数据 前 4 行</li><li>data.tail(5): 查看表格数据 后 5 行</li><li>data.sample(6): 查看表格数据 随机 6 行</li></ul></li><li><p>数据统计方法</p><ul><li>data.describe(): 查看<mark>数值类型特征</mark>的统计信息（总数、均值、标准差、最小值、最大值等）</li><li>data[&#39;Sex&#39;].value_counts(): 用于统计<mark>某列</mark>中每个唯一值的出现次数，常用参数有 normalize（返回类别比例）、ascending（升序排列）、dropna（是否忽略缺失值），参数都是布尔值</li></ul></li><li><p>数据信息获取</p><ul><li>data.info(): 查看数据集的基本信息（如列名、非空值数量、数据类型等）</li><li>data.columns(): 查看数据集的列名</li><li>data.shape(): 查看数据集的行数和列数</li><li>data.dtypes(): 查看每列的数据类型</li></ul></li><li><p>数据 缺失值 / 唯一值 检查</p><ul><li>data.isnull(): 返回一个布尔 DataFrame，表示每个值是否为缺失值</li><li>data.isnull().sum(): 统计每列的缺失值数量</li><li>data.nunique(): 统计每列的唯一值数量</li><li>data[&#39;Sex&#39;].unique(): 返回某列的唯一值列表</li></ul></li></ol><h3 id="_2-2-幸存者预测" tabindex="-1"><a class="header-anchor" href="#_2-2-幸存者预测"><span>2.2 幸存者预测</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 训练集数据和标签分割</span></span>
<span class="line">X_train <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line">y_train <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 标准化数据</span></span>
<span class="line">scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">X_train <span class="token operator">=</span> scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义模型，训练</span></span>
<span class="line">model <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试集数据预处理</span></span>
<span class="line">data1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;titanic/test.csv&quot;</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">&#39;Name&#39;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">&#39;Ticket&#39;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">&#39;Cabin&#39;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">data1<span class="token punctuation">[</span><span class="token string">&#39;Sex&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data1<span class="token punctuation">[</span><span class="token string">&#39;Sex&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;male&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;female&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">[</span><span class="token string">&#39;Age&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data1<span class="token punctuation">[</span><span class="token string">&#39;Age&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;Age&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">[</span><span class="token string">&#39;Fare&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data1<span class="token punctuation">[</span><span class="token string">&#39;Fare&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;Fare&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">[</span><span class="token string">&#39;Embarked&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data1<span class="token punctuation">[</span><span class="token string">&#39;Embarked&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 分割特征，预测幸存率</span></span>
<span class="line">X_test <span class="token operator">=</span> data1<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line">y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将乘客 ID 和预测结果组合成一个 DataFrame</span></span>
<span class="line">results <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;PassengerId&#39;</span><span class="token punctuation">:</span> data1<span class="token punctuation">[</span><span class="token string">&#39;PassengerId&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Survived&#39;</span><span class="token punctuation">:</span> y_pred</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 按照格式要求保存为 CSV 文件</span></span>
<span class="line">results<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">&#39;./titanic/pred_aosai_1.csv&#39;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>紧接着刚才训练集的数据处理，上方这段代码就是我第一次尝试解题的结果。但是很遗憾，计算出来的结果，我一看就知道肯定不对，因为生成的 CSV 文件中，预测结果全是 0，即全都不能幸存。提交后的结果为：准确率 62.2%。</p><h3 id="_2-3-尝试改进-失败" tabindex="-1"><a class="header-anchor" href="#_2-3-尝试改进-失败"><span>2.3 尝试改进（失败）</span></a></h3><p>首先是，我们需要对训练的好坏有一个认知，最基本的方法就是从训练集中拆分出来一部分，作为验证集，来验证模型训练的好坏，方法就是 train_test_split 函数。要注意的是，该方法默认不会保持标签类别比例，如果标签类别数量不均衡，需要用 stratify 参数。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 使用 stratify 参数保持标签的类别比例</span></span>
<span class="line">X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> stratify<span class="token operator">=</span>y<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>另一种评估模型性能的方法是交叉验证，其核心思想是：</p><ol><li>将数据集划分为 K 个子集（称为 K 折）。</li><li>轮流使用其中一个子集作为验证集，其余 K-1 个子集作为训练集。</li><li>在每一轮中训练模型并评估性能。</li><li>最终返回模型在 K 个验证集上的平均性能。</li></ol><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">model <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># cross_val_score 的参数为 模型对象，特征数据，标签数据，交叉验证的折数，评估指标</span></span>
<span class="line"><span class="token comment"># 评估指标有很多，常见的有：accuracy、f1、roc_auc 等</span></span>
<span class="line">scores <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>model<span class="token punctuation">,</span> X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">&#39;accuracy&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交叉验证准确率：&quot;</span><span class="token punctuation">,</span> scores<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;交叉验证的平均准确率：&quot;</span><span class="token punctuation">,</span> scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 结果</span></span>
<span class="line">交叉验证准确率： <span class="token punctuation">[</span><span class="token number">0.75977654</span> <span class="token number">0.78089888</span> <span class="token number">0.84269663</span> <span class="token number">0.76966292</span> <span class="token number">0.84269663</span><span class="token punctuation">]</span></span>
<span class="line">交叉验证的平均准确率： <span class="token number">0.799146318498525</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>1000 个数据以内的数据集通常被认为是小数据集。对于小数据集，交叉验证 是更推荐的方法，因为它可以更充分地利用数据，提供更可靠的模型评估。</p><p>评估模型性能的办法有了，然后就是使用 1.3 小节，决策树优化的各种方式，来尝试提高预测的准确率。需要注意的是：<mark>数据增强仅能用于训练集，如果用于验证集或者测试集，会导致数据泄漏，从而影响模型的评估性能</mark>。</p><p>所以 cross_val_score 函数直接搭配 SMOTE 是不可行的，但是网格搜索（GridSearchCV）的核心就包括交叉验证，我们可以通过 Pipeline，将数据增强和模型训练步骤整合到一起，并在 GridSearchCV 中实现交叉验证。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 训练集数据和标签分割</span></span>
<span class="line">X <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line">y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 标准化数据</span></span>
<span class="line">scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">X <span class="token operator">=</span> scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 划分训练集和验证集</span></span>
<span class="line">X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> stratify<span class="token operator">=</span>y<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建 Pipeline</span></span>
<span class="line">pipeline <span class="token operator">=</span> make_pipeline<span class="token punctuation">(</span></span>
<span class="line">    SMOTE<span class="token punctuation">(</span>k_neighbors<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    RandomForestClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义网格参数</span></span>
<span class="line">param_grid <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;randomforestclassifier__n_estimators&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;randomforestclassifier__max_depth&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;randomforestclassifier__min_samples_split&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;randomforestclassifier__min_samples_leaf&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;randomforestclassifier__max_features&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;sqrt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;log2&#39;</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用网格搜索</span></span>
<span class="line">grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> param_grid<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">&#39;accuracy&#39;</span><span class="token punctuation">)</span></span>
<span class="line">grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看交叉验证结果，输出最佳参数组合</span></span>
<span class="line">results <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>grid_search<span class="token punctuation">.</span>cv_results_<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&#39;params&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;mean_test_score&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;std_test_score&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;最佳参数：&quot;</span><span class="token punctuation">,</span> grid_search<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试集数据预处理</span></span>
<span class="line">data1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;titanic/test.csv&quot;</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">&#39;Name&#39;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">&#39;Ticket&#39;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">&#39;Cabin&#39;</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">data1<span class="token punctuation">[</span><span class="token string">&#39;Sex&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data1<span class="token punctuation">[</span><span class="token string">&#39;Sex&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;male&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;female&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">[</span><span class="token string">&#39;Age&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data1<span class="token punctuation">[</span><span class="token string">&#39;Age&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;Age&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">[</span><span class="token string">&#39;Fare&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data1<span class="token punctuation">[</span><span class="token string">&#39;Fare&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">&#39;Fare&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">data1<span class="token punctuation">[</span><span class="token string">&#39;Embarked&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data1<span class="token punctuation">[</span><span class="token string">&#39;Embarked&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 分割特征，使用模型的最佳参数进行预测</span></span>
<span class="line">X_test <span class="token operator">=</span> data1<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line">best_model <span class="token operator">=</span> grid_search<span class="token punctuation">.</span>best_estimator_</span>
<span class="line">y_pred <span class="token operator">=</span> best_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将乘客 ID 和预测结果组合成一个 DataFrame</span></span>
<span class="line">results <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;PassengerId&#39;</span><span class="token punctuation">:</span> data1<span class="token punctuation">[</span><span class="token string">&#39;PassengerId&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;Survived&#39;</span><span class="token punctuation">:</span> y_pred</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 按照格式要求保存为 CSV 文件</span></span>
<span class="line">results<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">&#39;./titanic/pred_aosai_2.csv&#39;</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>很遗憾，并没有什么提升，但是这个挑战题目已经公开有些年了，网络上有很多大佬们的博客，推荐大家看一看。这里贴两个我看过的：<a href="https://blog.csdn.net/weixin_45508265/article/details/112703541" target="_blank" rel="noopener noreferrer">CSDN - Titanic<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，<a href="https://zhuanlan.zhihu.com/p/176952225" target="_blank" rel="noopener noreferrer">知乎 - Titanic<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>这两篇博文对我来说最大的收获就是，在实际解决问题的过程中，数据分析真的很重要，只有做好了数据分析，我们才能对当前情况的特征做出合理的处理。在之前的练习中，我确实忽略了这一点（野外散修疯狂向宗门天骄学习）。</p><h2 id="_3-多分类问题" tabindex="-1"><a class="header-anchor" href="#_3-多分类问题"><span>3. 多分类问题</span></a></h2><h3 id="_3-1-鸢尾花分类" tabindex="-1"><a class="header-anchor" href="#_3-1-鸢尾花分类"><span>3.1 鸢尾花分类</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split</span>
<span class="line"><span class="token keyword">import</span> torch</span>
<span class="line"><span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader<span class="token punctuation">,</span> TensorDataset</span>
<span class="line"><span class="token keyword">from</span> torch <span class="token keyword">import</span> nn<span class="token punctuation">,</span> optim</span>
<span class="line"><span class="token keyword">import</span> random</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 固定随机数种子</span></span>
<span class="line">random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line">torch<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 加载数据，定义列名</span></span>
<span class="line">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&quot;./iris/iris.data&quot;</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></span>
<span class="line">data<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;sepal_len&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sepal_width&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;petal_len&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;petal_width&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;class_name&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将分类标签转化为数字</span></span>
<span class="line">name_map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;Iris-setosa&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;Iris-versicolor&#39;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;Iris-virginica&#39;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span></span>
<span class="line">data<span class="token punctuation">[</span><span class="token string">&#39;class_name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;class_name&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>name_map<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 提取特征和标签</span></span>
<span class="line">X <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line">y <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;class_name&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 标准化数据，拆分训练集和测试集</span></span>
<span class="line">scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">X_scaled <span class="token operator">=</span> scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X<span class="token punctuation">)</span></span>
<span class="line">X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X_scaled<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 转化为张量，创建 DataLoader</span></span>
<span class="line">train_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>TensorDataset<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                                        torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                                        batch_size<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">test_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>TensorDataset<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                                       torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                                       batch_size<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 定义 Softmax 神经网络模型</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">SoftmaxNN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token builtin">super</span><span class="token punctuation">(</span>SoftmaxNN<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span></span>
<span class="line">            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>net<span class="token punctuation">(</span>x<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 实例化模型、损失函数、优化器</span></span>
<span class="line">model <span class="token operator">=</span> SoftmaxNN<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 训练模型</span></span>
<span class="line">epochs <span class="token operator">=</span> <span class="token number">20</span></span>
<span class="line"><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    running_loss <span class="token operator">=</span> <span class="token number">0.0</span></span>
<span class="line">    correct <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    total <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">for</span> inputs<span class="token punctuation">,</span> labels <span class="token keyword">in</span> train_loader<span class="token punctuation">:</span></span>
<span class="line">        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span></span>
<span class="line">        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> labels<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        running_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        total <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">        correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    train_loss <span class="token operator">=</span> running_loss <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span></span>
<span class="line">    train_accuracy <span class="token operator">=</span> correct <span class="token operator">/</span> total</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> epoch <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Epoch </span><span class="token interpolation"><span class="token punctuation">{</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>epochs<span class="token punctuation">}</span></span><span class="token string">, Loss: </span><span class="token interpolation"><span class="token punctuation">{</span>train_loss<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">, Accuracy: </span><span class="token interpolation"><span class="token punctuation">{</span>train_accuracy<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试模型</span></span>
<span class="line">model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">correct <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">total <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> inputs<span class="token punctuation">,</span> labels <span class="token keyword">in</span> test_loader<span class="token punctuation">:</span></span>
<span class="line">        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span></span>
<span class="line">        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        total <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">        correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">test_accuracy <span class="token operator">=</span> correct <span class="token operator">/</span> total</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Test Accuracy: </span><span class="token interpolation"><span class="token punctuation">{</span>test_accuracy<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在机器学习和深度学习中，很多操作是随机的，例如：数据划分（如 train_test_split）；数据划分（如 train_test_split）；数据加载时的打乱顺序（如 DataLoader 的 shuffle=True）等等。</p><p>固定随机种子可以确保每次运行代码时，这些随机操作的结果一致，从而使实验结果可重复。但是不同的库，都有自己的随机数生成器，所以需要都统一固定。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># Mac 仅用前三个就足够；英伟达显卡 cuda 需要全部六个。</span></span>
<span class="line"></span>
<span class="line">random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 固定 Python 随机种子</span></span>
<span class="line">np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 固定 NumPy 随机种子</span></span>
<span class="line">torch<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 固定 PyTorch 随机种子（Mac 的 CPU MPS 都包含）</span></span>
<span class="line"></span>
<span class="line">torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>manual_seed<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>  <span class="token comment"># 固定 GPU 随机种子（如果使用 GPU）</span></span>
<span class="line">torch<span class="token punctuation">.</span>backends<span class="token punctuation">.</span>cudnn<span class="token punctuation">.</span>deterministic <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 确保 CuDNN 确定性</span></span>
<span class="line">torch<span class="token punctuation">.</span>backends<span class="token punctuation">.</span>cudnn<span class="token punctuation">.</span>benchmark <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 禁用 CuDNN 自动优化</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其次是创建 DataLoader 那里，该函数已经在上一章节讲过，要说明的是里面嵌套的两个，torch.tensor 和 TensorDataset：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># torch.tensor 将数据（如 NumPy 数组或 Python 列表）转换为 PyTorch 张量。</span></span>
<span class="line">tensor_data <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float32<span class="token punctuation">)</span></span>
<span class="line">tensor_label <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># TensorDataset 将输入特征和标签打包成一个数据集对象，方便通过索引访问。</span></span>
<span class="line">dataset <span class="token operator">=</span> TensorDataset<span class="token punctuation">(</span>tensor_data<span class="token punctuation">,</span> tensor_label<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另一个要说的就是新的模型方法 Sequential。nn.Sequential 是 PyTorch 中的一个容器（Container），用于按顺序组合多个层。它可以将多个层（如 Linear、Conv2d、ReLU 等）打包成一个模块，避免重复写 forward 函数，简化模型定义。其余的内容我在别的地方都有提到过，就不重复了，最后贴一下结果吧：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">Epoch <span class="token number">5</span><span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">,</span> Loss<span class="token punctuation">:</span> <span class="token number">0.2541</span><span class="token punctuation">,</span> Accuracy<span class="token punctuation">:</span> <span class="token number">91.67</span></span>
<span class="line">Epoch <span class="token number">10</span><span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">,</span> Loss<span class="token punctuation">:</span> <span class="token number">0.1040</span><span class="token punctuation">,</span> Accuracy<span class="token punctuation">:</span> <span class="token number">95.83</span></span>
<span class="line">Epoch <span class="token number">15</span><span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">,</span> Loss<span class="token punctuation">:</span> <span class="token number">0.0744</span><span class="token punctuation">,</span> Accuracy<span class="token punctuation">:</span> <span class="token number">96.67</span></span>
<span class="line">Epoch <span class="token number">20</span><span class="token operator">/</span><span class="token number">20</span><span class="token punctuation">,</span> Loss<span class="token punctuation">:</span> <span class="token number">0.0659</span><span class="token punctuation">,</span> Accuracy<span class="token punctuation">:</span> <span class="token number">95.83</span></span>
<span class="line">Test Accuracy<span class="token punctuation">:</span> <span class="token number">100.00</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-猫狗图像区分" tabindex="-1"><a class="header-anchor" href="#_3-2-猫狗图像区分"><span>3.2 猫狗图像区分</span></a></h3><p>该项目我使用了预训练模型 ResNet-18，它是一个非常常见的卷积神经网络（CNN）架构，它被设计用来在计算机视觉任务中提取图像特征。使用预训练模型的好处是，可以避免从头开始训练模型，这样会大大减少训练时间和计算资源，所以它们（ResNet，VGG，AlexNet 等等）常常被拿来做迁移学习。</p><p>这些预训练模型大都是通过 ImageNet 的数据集做的训练，因此相关参数设置为 ImageNet 对应值，训练的效果会更好，比如图像标准化时对应 RGB 通道的均值和标准差。其余涉及到的新函数我会写在下一小节（3.3），和鸢尾花分类一样，还是代码全部贴上。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> torch</span>
<span class="line"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn</span>
<span class="line"><span class="token keyword">import</span> torch<span class="token punctuation">.</span>optim <span class="token keyword">as</span> optim</span>
<span class="line"><span class="token keyword">from</span> torchvision <span class="token keyword">import</span> datasets<span class="token punctuation">,</span> transforms<span class="token punctuation">,</span> models</span>
<span class="line"><span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">import</span> DataLoader</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置训练和测试数据集路径</span></span>
<span class="line">train_dir <span class="token operator">=</span> <span class="token string">&quot;./archive/training_set/training_set/&quot;</span></span>
<span class="line">test_dir <span class="token operator">=</span> <span class="token string">&quot;./archive/test_set/test_set/&quot;</span></span>
<span class="line"></span>
<span class="line">transform <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">    <span class="token comment"># ResNet 预训练模型的标准输入尺寸为 224x224</span></span>
<span class="line">    transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment"># 基于 ImageNet 的 RGB 三通道的均值和标准差分别如下</span></span>
<span class="line">    transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span>mean<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.485</span><span class="token punctuation">,</span> <span class="token number">0.456</span><span class="token punctuation">,</span> <span class="token number">0.406</span><span class="token punctuation">]</span><span class="token punctuation">,</span> std<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.229</span><span class="token punctuation">,</span> <span class="token number">0.224</span><span class="token punctuation">,</span> <span class="token number">0.225</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 加载训练数据和测试数据</span></span>
<span class="line">train_data <span class="token operator">=</span> datasets<span class="token punctuation">.</span>ImageFolder<span class="token punctuation">(</span>root<span class="token operator">=</span>train_dir<span class="token punctuation">,</span> transform<span class="token operator">=</span>transform<span class="token punctuation">)</span></span>
<span class="line">test_data <span class="token operator">=</span> datasets<span class="token punctuation">.</span>ImageFolder<span class="token punctuation">(</span>root<span class="token operator">=</span>test_dir<span class="token punctuation">,</span> transform<span class="token operator">=</span>transform<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建数据加载器</span></span>
<span class="line">batch_size <span class="token operator">=</span> <span class="token number">32</span></span>
<span class="line">train_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">test_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>test_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用预训练的 ResNet18 作为基础模型</span></span>
<span class="line">model <span class="token operator">=</span> models<span class="token punctuation">.</span>resnet18<span class="token punctuation">(</span>weights<span class="token operator">=</span><span class="token string">&#39;IMAGENET1K_V1&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 替换最后一层，适应我们猫狗分类的任务（2个类）</span></span>
<span class="line">model<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>model<span class="token punctuation">.</span>fc<span class="token punctuation">.</span>in_features<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 选择 GPU 或 CPU，定义损失函数和优化器</span></span>
<span class="line">device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">&quot;mps&quot;</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>backends<span class="token punctuation">.</span>mps<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">&quot;cpu&quot;</span><span class="token punctuation">)</span></span>
<span class="line">model <span class="token operator">=</span> model<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span></span>
<span class="line">criterion <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">optimizer <span class="token operator">=</span> optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 训练模型</span></span>
<span class="line">num_epochs <span class="token operator">=</span> <span class="token number">5</span></span>
<span class="line"><span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    model<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    running_loss <span class="token operator">=</span> <span class="token number">0.0</span></span>
<span class="line">    correct <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    total <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">    <span class="token keyword">for</span> inputs<span class="token punctuation">,</span> labels <span class="token keyword">in</span> train_loader<span class="token punctuation">:</span></span>
<span class="line">        inputs<span class="token punctuation">,</span> labels <span class="token operator">=</span> inputs<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 前向传播</span></span>
<span class="line">        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span></span>
<span class="line">        loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> labels<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 清除之前的梯度，反向传播并优化</span></span>
<span class="line">        optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 计算准确率</span></span>
<span class="line">        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        total <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        running_loss <span class="token operator">+=</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    epoch_loss <span class="token operator">=</span> running_loss <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_loader<span class="token punctuation">)</span></span>
<span class="line">    epoch_accuracy <span class="token operator">=</span> correct <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Epoch [</span><span class="token interpolation"><span class="token punctuation">{</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span>num_epochs<span class="token punctuation">}</span></span><span class="token string">], Loss: </span><span class="token interpolation"><span class="token punctuation">{</span>epoch_loss<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">, Accuracy: </span><span class="token interpolation"><span class="token punctuation">{</span>epoch_accuracy<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试模型</span></span>
<span class="line">model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">correct <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">total <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"><span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> inputs<span class="token punctuation">,</span> labels <span class="token keyword">in</span> test_loader<span class="token punctuation">:</span></span>
<span class="line">        inputs<span class="token punctuation">,</span> labels <span class="token operator">=</span> inputs<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> labels<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span></span>
<span class="line">        outputs <span class="token operator">=</span> model<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span></span>
<span class="line">        _<span class="token punctuation">,</span> predicted <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        correct <span class="token operator">+=</span> <span class="token punctuation">(</span>predicted <span class="token operator">==</span> labels<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        total <span class="token operator">+=</span> labels<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">test_accuracy <span class="token operator">=</span> correct <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Test Accuracy: </span><span class="token interpolation"><span class="token punctuation">{</span>test_accuracy<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 保存模型</span></span>
<span class="line">torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;./archive/cat_dog_classifier.pth&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-猫狗分类笔记" tabindex="-1"><a class="header-anchor" href="#_3-3-猫狗分类笔记"><span>3.3 猫狗分类笔记</span></a></h3><p>（1）ImageFolder</p><p>它是 PyTorch 中 torchvision.datasets 模块提供的一个非常实用的类，用于加载图像数据集。它的主要作用是从给定的目录中读取图像，并根据图像所在的子文件夹来自动为每个图像分配标签。ImageFolder 假设数据集的目录结构如下：</p><ul><li>root: 根目录，指向数据集文件夹。</li><li>class_a, class_b, …: 每个子文件夹代表一个类别，子文件夹的名字就是该类别的标签。</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">root<span class="token operator">/</span></span>
<span class="line">    class_a<span class="token operator">/</span></span>
<span class="line">        image1<span class="token punctuation">.</span>jpg</span>
<span class="line">        image2<span class="token punctuation">.</span>jpg</span>
<span class="line">        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    class_b<span class="token operator">/</span></span>
<span class="line">        image1<span class="token punctuation">.</span>jpg</span>
<span class="line">        image2<span class="token punctuation">.</span>jpg</span>
<span class="line">        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ImageFolder 的关键参数有四个：</p><ol><li>root：数据集的根目录路径。</li><li>transform：可选函数，用于对图像进行预处理（例如缩放、裁剪等）。返回的是张量 Tensor。</li><li>target_transform：可选函数，用于处理标签的转换（例如标签的数字编码转化为 one-hot 编码等）。</li><li>loader：可选的自定义图像加载函数，默认使用 PIL.Image.open 来加载图像。如果图像格式不同，可以通过这个参数自定义加载方法。</li></ol><p>要注意的是，我将该数据集下载下来后，每个子文件夹（dogs，cats）中存在一个非图像文件，该文件不是必要文件，所以直接删除即可。如果是必要文件，可以用 PIL 库或者 OpenCV 库去过滤掉非图像文件。</p><p>（2）resnet18</p><p>ResNet 有很多个模型，18 号只是其中一个，模型的参数 weights 表示权重，IMAGENET1K_V1 是标准权重，即在 ImageNet 的数据集上训练出来的。预训练的权重意味着这个网络已经学到了如何识别一些通用的图像特征（例如边缘、纹理、形状等），它可以快速迁移到别的识别任务中去。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">model <span class="token operator">=</span> models<span class="token punctuation">.</span>resnet18<span class="token punctuation">(</span>weights<span class="token operator">=</span><span class="token string">&#39;IMAGENET1K_V1&#39;</span><span class="token punctuation">)</span></span>
<span class="line">model<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>model<span class="token punctuation">.</span>fc<span class="token punctuation">.</span>in_features<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>model.fc 表示 ResNet18 的最后一层（全连接层），它是用来分类 1000 个类别的，所以我们需要将其转换为猫狗识别的 2 类，使用新的全连接层 nn.Linear 替换原本的。</p><p>model.fc.in_features 获取了最后一层全连接层的输入特征数（即之前网络提取到的特征的数量）。</p><p>（3）调参及结果</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line">Epoch <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Loss<span class="token punctuation">:</span> <span class="token number">0.2004</span><span class="token punctuation">,</span> Accuracy<span class="token punctuation">:</span> <span class="token number">91.86</span><span class="token operator">%</span></span>
<span class="line">Epoch <span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Loss<span class="token punctuation">:</span> <span class="token number">0.1295</span><span class="token punctuation">,</span> Accuracy<span class="token punctuation">:</span> <span class="token number">95.12</span><span class="token operator">%</span></span>
<span class="line">Epoch <span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Loss<span class="token punctuation">:</span> <span class="token number">0.1561</span><span class="token punctuation">,</span> Accuracy<span class="token punctuation">:</span> <span class="token number">93.68</span><span class="token operator">%</span></span>
<span class="line">Epoch <span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Loss<span class="token punctuation">:</span> <span class="token number">0.0820</span><span class="token punctuation">,</span> Accuracy<span class="token punctuation">:</span> <span class="token number">96.78</span><span class="token operator">%</span></span>
<span class="line">Epoch <span class="token punctuation">[</span><span class="token number">5</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Loss<span class="token punctuation">:</span> <span class="token number">0.0701</span><span class="token punctuation">,</span> Accuracy<span class="token punctuation">:</span> <span class="token number">97.21</span><span class="token operator">%</span></span>
<span class="line">Test Accuracy<span class="token punctuation">:</span> <span class="token number">94.22</span><span class="token operator">%</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我的 Mac M3 Air 跑这个项目倒是也能跑，就是跑的太慢了，算力一般还发热，所以我试过几次之后就不想继续了，这里做一个记录和改进的思路。</p><p>Batch_size 对于内存的占用没有我想象的高，224*224 的图像，我从 16 调到了 64，只增加了 1GB 多的内存使用。学习率我试过 0.01 为初始值，效果没有 0.001 好，并且我也尝试过学习率衰退函数（写在优化器的后面）：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># 参数为举例：每训练 10 个 epoch 就把学习率减小 10 倍</span></span>
<span class="line">scheduler <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>lr_scheduler<span class="token punctuation">.</span>StepLR<span class="token punctuation">(</span>optimizer<span class="token punctuation">,</span> step_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>因为算力不够，运行时间太长，我就两步一跳，结果过拟合了感觉，训练集的准确率上来了，测试集反而下降了。之后我就没有再尝试了，直接采用了第一次的参数，如上一小节代码所示。</p><p>（4）另一个优化思路</p><p>该数据集总共有 1 万张图像，训练集中猫狗各 4000 张，测试集中猫狗各 1000 张，从数量的角度来看算是中小型数据集。我们使用的方法是基于 CNN 的 ResNet，CNN 的特点是要所有图像固定统一的尺寸。</p><p>对于<mark>长宽比差别较小</mark>的图像而言，直接 resize 成正方形是简单有效的办法，因为即使图像有形变，但是对主体的特征学习而言，是可以被机器辨别和接受的。</p><p>对于<mark>长宽比差别较大</mark>的图像（1:2 甚至 1:3），可以使用 Padding 填充短的那边。如果直接用 0（黑色像素）或者 256（白色像素）填充，可能会引入很多噪声，建议使用均值，以及将图像主体放在中央的形式，减少填充后噪声带来的影响。</p><p>对于<mark>重要信息在边缘</mark>的情况，可以尝试裁剪，或者考虑多尺度训练。</p><p>我用代码统计过，训练集中长宽比超过 1:2 的图像数量为 75 个，测试集中长宽比超过 1:2 图像数量为 12 个，数量很少，可以考虑直接删除训练集中的 75 个数据，或者对其做 Padding。训练集也是一样的思路，可以对比 3 次，删除这 12 个数据，不处理直接用，对这 12 个数据做 Padding，然后看看结果。</p></div></div><footer class="page-meta"><!----><!----></footer><nav class="page-nav"><p class="hasPrev hasNext inner"><span class="page-nav-item prev"> ← 实战1-离散分类问题</span><span class="page-nav-item next">实战2-线性拟合问题 → </span></p></nav><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_1-二分类问题-其一" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. 二分类问题 - 其一"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. 二分类问题 - 其一<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_1-1-数据格式" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.1 数据格式"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.1 数据格式<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_1-2-肿瘤分类" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.2 肿瘤分类"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.2 肿瘤分类<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_1-3-决策树优化" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1.3 决策树优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1.3 决策树优化<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_2-二分类问题-其二" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. 二分类问题 - 其二"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. 二分类问题 - 其二<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_2-1-pandas-数据检查方法" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.1 Pandas 数据检查方法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.1 Pandas 数据检查方法<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_2-2-幸存者预测" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.2 幸存者预测"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.2 幸存者预测<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_2-3-尝试改进-失败" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.3 尝试改进（失败）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.3 尝试改进（失败）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_3-多分类问题" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3. 多分类问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3. 多分类问题<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_3-1-鸢尾花分类" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.1 鸢尾花分类"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.1 鸢尾花分类<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_3-2-猫狗图像区分" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.2 猫狗图像区分"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.2 猫狗图像区分<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blogs/intelligence/PyTorch/02_project2.html#_3-3-猫狗分类笔记" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.3 猫狗分类笔记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.3 猫狗分类笔记<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-Ccl-ihA3.js" defer></script>
  </body>
</html>
